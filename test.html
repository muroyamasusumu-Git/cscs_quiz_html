<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>NSCA CSCS å•é¡Œé›†ä¸€è¦§</title>
<style>
  :root{
    --bg:#0b0b0c; --fg:#e9e9ec; --muted:#a7a7b3; --card:#141418;
    --line:#2b2b36; --accent:#8ab4ff; --ok:#6ee7a0; --warn:#ffd166; --bad:#ff6b6b;
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Hiragino Sans","Noto Sans JP",sans-serif;}
  a{color:inherit;text-decoration:none}
  .wrap{max-width:1200px;margin:0 auto;padding:20px 16px 40px}
  header{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:16px}
  header h1{font-size:18px;margin:0 12px 0 0}
  .tools{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .chip{border:1px solid var(--line);border-radius:10px;padding:6px 10px;font-size:12px;cursor:pointer}
  .chip.active{border-color:var(--accent);box-shadow:0 0 0 1px var(--accent) inset}
  .search{display:flex;gap:8px;align-items:center;margin-left:auto;min-width:260px}
  .search input{background:transparent;color:var(--fg);border:1px solid var(--line);border-radius:10px;padding:8px 10px;width:100%}
  .grid{
    display:grid; gap:16px;
    grid-template-columns: repeat(4, minmax(0,1fr));
  }
  /* 3åˆ— */
  @media (max-width: 1199px){
    .grid{grid-template-columns: repeat(3, minmax(0,1fr));}
  }
  /* 2åˆ—ï¼ˆæœ€ä½2åˆ—ã‚’ä¿è¨¼ï¼‰ */
  @media (max-width: 959px){
    .grid{grid-template-columns: repeat(2, minmax(0,1fr));}
  }
  /* 2åˆ—ã‚­ãƒ¼ãƒ—ï¼ˆè¶…å°å¹…ã§ã‚‚1åˆ—ã«å´©ã•ãªã„ï¼‰ */
  @media (max-width: 520px){
    .wrap{padding-left:10px;padding-right:10px}
  }
  .card{
    border:1px solid var(--line);border-radius:12px;background:var(--card);
    padding:12px 12px 10px;display:flex;flex-direction:column;gap:10px
  }
  .row{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .row.space{justify-content:space-between}
  .date{font-weight:600}
  .badge{font-size:12px;color:var(--muted);border:1px solid var(--line);border-radius:8px;padding:2px 8px}
  .badge.ok{color:var(--ok);border-color:var(--ok)}
  .badge.warn{color:var(--warn);border-color:var(--warn)}
  .tags{display:flex;gap:6px;flex-wrap:wrap}
  .tag{border:1px solid var(--line);border-radius:10px;padding:2px 8px;font-size:12px;color:var(--muted)}
  .levels{display:flex;gap:4px;align-items:center}
  .lvbar{flex:1;height:6px;border:1px solid var(--line);border-radius:999px;overflow:hidden;display:flex}
  .lvbar span{height:100%;border-right:1px solid var(--bg)}
  .lv1{flex:var(--l1)} .lv2{flex:var(--l2)} .lv3{flex:var(--l3)} .lv4{flex:var(--l4)} .lv5{flex:var(--l5)}
  .lv1{background:#7aa2f7} .lv2{background:#9ece6a} .lv3{background:#e0af68}
  .lv4{background:#f7768e} .lv5{background:#bb9af7}
  .meter{display:flex;align-items:center;gap:8px}
  .bar{flex:1;height:8px;border:1px solid var(--line);border-radius:999px;position:relative;background:rgba(255,255,255,0.04)}
  .fill{position:absolute;inset:0 0 0 0;transform-origin:left center}
  .fill.progress{background:linear-gradient(90deg,var(--accent),#b5d0ff)}
  .fill.clear{background:linear-gradient(90deg,var(--ok),#a9f3c5)}
  .actions{display:flex;gap:10px;align-items:center;border-top:1px dashed var(--line);padding-top:10px}
  .action{font-size:13px;color:var(--muted);border-bottom:1px dotted var(--muted);cursor:pointer}
  .action:hover{color:var(--fg);border-color:var(--fg)}
  .card:hover{border-color:var(--accent)}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>NSCA CSCS å•é¡Œé›†ä¸€è¦§</h1>
      <div class="tools">
        <div class="chip" data-filter="all">ã™ã¹ã¦</div>
        <div class="chip" data-filter="todo">æœªç€æ‰‹</div>
        <div class="chip" data-filter="doing">é€²è¡Œä¸­</div>
        <div class="chip" data-filter="done">Clearæ¸ˆã¿</div>
        <div class="chip" data-sort="date">æ—¥ä»˜â†“</div>
        <div class="chip" data-sort="rate">é”æˆåº¦â†‘</div>
        <div class="chip" data-sort="level">Læ¯”ç‡</div>
      </div>
      <div class="search">
        <input id="q" type="search" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ï¼ˆåˆ†é‡/ãƒ†ãƒ¼ãƒãªã©ï¼‰" />
      </div>
    </header>

    <section class="grid" id="grid"></section>
  </div>

<script>
/** ========== è¨­å®š ========== */
const BUILD_PREFIX = "_build_"; // ä¾‹: ./_build_cscs_20251104/slides/q001_a.html
const USE_MANIFEST = false;     // ã¾ãšã¯ç¢ºå®Ÿã«å‹•ã‹ã™ï¼ˆå¾Œã§ true ã«æˆ»ã™ï¼‰

/** ========== ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆmanifest.jsonå„ªå…ˆ â†’ ä»®ãƒ‡ãƒ¼ã‚¿ï¼‰ ========== */
async function fetchManifest(){
  if(!USE_MANIFEST) return null;
  try{
    // ãƒ«ãƒ¼ãƒˆã« manifest.json ãŒã‚ã‚‹å‰æï¼ˆãªã‘ã‚Œã° catch ã¸ï¼‰
    const res = await fetch("./manifest.json", {cache:"no-store"});
    if(!res.ok) throw new Error("no manifest");
    return await res.json();
  }catch(e){
    return null;
  }
}

/** ä»®ãƒ‡ãƒ¼ã‚¿ï¼ˆ90æ—¥åˆ†ï¼‰ : å®Ÿè£…ã®æ„Ÿè§¦å‡ºã—ç”¨ */
function mockData(){
  // ä¾‹ï¼š2025-09-26ã€œ2025-12-24ã®90æ—¥ï¼ˆå®Ÿãƒ‡ãƒ¼ã‚¿ã«åˆã‚ã›ã¦èª¿æ•´OKï¼‰
  const start = new Date("2025-09-26T00:00:00");
  const days = 90;
  const fields = ["é‹å‹•ç”Ÿç†","ãƒã‚¤ã‚ªãƒ¡","æ „é¤Š","ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨­è¨ˆ","ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯","ã‚¹ãƒãƒ¼ãƒ„å¿ƒç†"];
  const themes = ["é€Ÿåº¦-åŠ›","ç‰¹æ®Šé›†å›£","ãƒ—ãƒ­ã‚°ãƒ©ãƒ è¨­è¨ˆ","ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¾›çµ¦","ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯","ç–²åŠ´ç®¡ç†","å®‰å…¨"];
  const arr = [];
  for(let i=0;i<days;i++){
    const d = new Date(start.getTime() + i*86400000);
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,"0");
    const dd = String(d.getDate()).padStart(2,"0");
    const dateStr = `${yyyy}-${mm}-${dd}`;
    const idStr = `${yyyy}${mm}${dd}`;

    // ä»®ã®ãƒ¬ãƒ™ãƒ«æ¯”ç‡ï¼ˆL1ã€œL5ï¼‰
    let l1=Math.random()*0.25+0.05, l2=Math.random()*0.3+0.1, l3=Math.random()*0.3+0.1, l4=Math.random()*0.2+0.05, l5=Math.random()*0.15;
    const sum = l1+l2+l3+l4+l5; l1/=sum; l2/=sum; l3/=sum; l4/=sum; l5/=sum;

    const progress = Math.random();           // 0ã€œ1
    const clear = Math.max(0, progress-0.2);  // é€²æ—ã‚ˆã‚Šå°‘ã—ä½ã‚
    const status = clear >= 1 ? "done" : progress>0 ? "doing" : "todo";
    const tagset = shuffle([...themes]).slice(0, Math.random()<0.5?2:3);
    arr.push({
      idx: i+1, date: dateStr, ymd: idStr,
      fields: shuffle(fields).slice(0,3),
      tags: tagset,
      level: {l1,l2,l3,l4,l5},
      progress, clear, status
    });
  }
  return arr;
}
function shuffle(a){return a.map(v=>[Math.random(),v]).sort((x,y)=>x[0]-y[0]).map(x=>x[1]);}

/** manifest.json â†’ ã‚«ãƒ¼ãƒ‰ç”¨ãƒ‡ãƒ¼ã‚¿ã¸ï¼ˆå¿…è¦ã«å¿œã˜ã¦åˆã‚ã›ã‚‹ï¼‰ */
function fromManifest(json){
  // æƒ³å®šå½¢ï¼š[{ date:"2025-11-04", ymd:"20251104", fields:["é‹å‹•ç”Ÿç†",...], tags:["é€Ÿåº¦-åŠ›",...], level:{l1:0.2,...}, progress:0.6, clear:0.4, status:"doing" }, ...]
  // å®Ÿãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚­ãƒ¼ã«åˆã‚ã›ã¦ã“ã“ã‚’èª¿æ•´ã™ã‚Œã°OK
  if(!Array.isArray(json)) return null;
  return json.map((e,i)=>{
    const dateStr = e.date || "";
    const ymd = e.ymd || dateStr.split("-").join(""); // â† Safariäº’æ›
    return {
      idx: i+1,
      date: dateStr,
      ymd,
      fields: e.fields||[],
      tags: e.tags||[],
      level: e.level||{l1:.2,l2:.3,l3:.2,l4:.2,l5:.1},
      progress: e.progress ?? 0,
      clear: e.clear ?? 0,
      status: e.status || "todo"
    };
  });
}

/** ========== æç”» ========== */
const grid = document.getElementById("grid");
let DATA = [];       // å…¨ä½“ãƒ‡ãƒ¼ã‚¿
let VIEW = [];       // è¡¨ç¤ºç”¨ï¼ˆãƒ•ã‚£ãƒ«ã‚¿/ã‚½ãƒ¼ãƒˆå¾Œï¼‰
let CURRENT_FILTER="all";
let CURRENT_SORT="date";
let QUERY="";

function percent(n){return Math.round(n*100);}
function count(n){return Math.round(n*30);}

function cardHTML(item){
  const {idx,date,ymd,fields,tags,level,progress,clear,status} = item;
  const link = `./${BUILD_PREFIX}cscs_${ymd}/slides/q001_a.html`;
  const badge = status==="done" ? "badge ok" : status==="doing" ? "badge warn" : "badge";
  const doneLabel = status==="done" ? "å®Œäº†" : status==="doing" ? "é€²è¡Œä¸­" : "æœªç€æ‰‹";
  const levelsStyle = `--l1:${level.l1};--l2:${level.l2};--l3:${level.l3};--l4:${level.l4};--l5:${level.l5};`;
  return `
  <article class="card" data-date="${date}" data-status="${status}">
    <div class="row space">
      <div class="row">
        <span class="date">${date}</span>
        <span class="badge">(${idx}/90)</span>
      </div>
      <span class="${badge}">${doneLabel}</span>
    </div>

    <div class="row" style="gap:6px;color:var(--muted);font-size:13px">
      <span>åˆ†é‡: ${fields.slice(0,3).join(" / ")}</span>
    </div>

    <div class="tags">
      ${tags.map(t=>`<span class="tag">${t}</span>`).join("")}
    </div>

    <div class="levels" title="ãƒ¬ãƒ™ãƒ«åˆ†å¸ƒ L1-L5">
      <small style="color:var(--muted)">L1â€“L5</small>
      <div class="lvbar" style="${levelsStyle}">
        <span class="lv1"></span><span class="lv2"></span><span class="lv3"></span><span class="lv4"></span><span class="lv5"></span>
      </div>
    </div>

    <div class="meter">
      <small style="width:54px;color:var(--muted)">é€²æ—</small>
      <div class="bar"><div class="fill progress" style="transform:scaleX(${Math.min(progress,1)})"></div></div>
      <small>${count(progress)}/30</small>
    </div>
    <div class="meter">
      <small style="width:54px;color:var(--muted)">Clear</small>
      <div class="bar"><div class="fill clear" style="transform:scaleX(${Math.min(clear,1)})"></div></div>
      <small>${count(clear)}/30</small>
    </div>

    <div class="actions">
      <a class="action" href="${link}">â–¶ å†é–‹</a>
      <a class="action" href="${link.replace("q001_a.html","result.html")}">ğŸ“Š çµ±è¨ˆ</a>
      <a class="action" href="#" onclick="alert('é¡ä¼¼å•é¡Œã¯å¾Œã§æ¥ç¶š');return false;">ğŸ§  é¡ä¼¼å•é¡Œ</a>
      <a class="action" href="#" onclick="alert('â˜…ã¯å¾Œã§å®Ÿè£…');return false;">ğŸ”– â˜…</a>
    </div>
  </article>
  `;
}

function render(){
  const html = VIEW
    .filter(it=>{
      if(CURRENT_FILTER==="todo" && it.status!=="todo") return false;
      if(CURRENT_FILTER==="doing" && it.status!=="doing") return false;
      if(CURRENT_FILTER==="done" && it.status!=="done") return false;
      if(QUERY){
        const hay = [it.date, ...it.fields, ...it.tags].join(" ").toLowerCase();
        if(!hay.includes(QUERY)) return false;
      }
      return true;
    })
    .map(cardHTML)
    .join("");
  grid.innerHTML = html || `<div style="color:var(--muted)">è©²å½“ã™ã‚‹å•é¡Œé›†ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</div>`;
}

function sortData(){
  if(CURRENT_SORT==="date"){
    VIEW.sort((a,b)=> a.date < b.date ? 1 : -1); // æ—¥ä»˜â†“
  }else if(CURRENT_SORT==="rate"){
    VIEW.sort((a,b)=> (b.clear - a.clear) || (b.progress - a.progress));
  }else if(CURRENT_SORT==="level"){
    // ä¾‹ï¼šé«˜ãƒ¬ãƒ™ãƒ«(L4+L5)æ¯”ç‡ãŒé«˜ã„é †
    const hv = it => (it.level.l4||0)+(it.level.l5||0);
    VIEW.sort((a,b)=> hv(b)-hv(a));
  }
}

function bindUI(){
  document.querySelectorAll(".chip[data-filter]").forEach(el=>{
    el.addEventListener("click",()=>{
      document.querySelectorAll(".chip[data-filter]").forEach(c=>c.classList.remove("active"));
      el.classList.add("active");
      CURRENT_FILTER = el.getAttribute("data-filter");
      render();
    });
  });
  document.querySelectorAll(".chip[data-sort]").forEach(el=>{
    el.addEventListener("click",()=>{
      document.querySelectorAll(".chip[data-sort]").forEach(c=>c.classList.remove("active"));
      el.classList.add("active");
      CURRENT_SORT = el.getAttribute("data-sort");
      sortData(); render();
    });
  });
  const q = document.getElementById("q");
  q.addEventListener("input",()=>{
    QUERY = q.value.trim().toLowerCase();
    render();
  });
}

(async function init(){
  try{
    let data = await fetchManifest();
    DATA = data ? fromManifest(data) : mockData();
    VIEW = [...DATA];
    sortData();
    bindUI();
    // åˆæœŸçŠ¶æ…‹ã®å¼·èª¿
    document.querySelector('.chip[data-filter="all"]').classList.add("active");
    document.querySelector('.chip[data-sort="date"]').classList.add("active");
    render();
  }catch(err){
    console.error(err);
    const wrap = document.querySelector(".wrap");
    const div = document.createElement("div");
    div.style.background = "rgba(255,0,0,0.08)";
    div.style.border = "1px solid #ff6b6b";
    div.style.color = "#ffb3b3";
    div.style.padding = "12px";
    div.style.borderRadius = "8px";
    div.style.marginTop = "12px";
    div.textContent = "åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸ: " + (err && err.message ? err.message : String(err));
    wrap.prepend(div);
  }
})();
</script>
</body>
</html>