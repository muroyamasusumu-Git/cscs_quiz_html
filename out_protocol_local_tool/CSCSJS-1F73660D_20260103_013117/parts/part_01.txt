<<<PART_BEGIN>>>
ã€åˆ†å‰²ã‚³ãƒ¼ãƒ‰(1)ã®é–‹å§‹ã€‘
PartID: CSCSJS-1F73660D-P01-of-05
PartSHA256: a837403a89ce1421c58571917c50ef93fcae40a6038b02acc52dbbbf14eba6ae
Range: chars 0..38758 (len=38758)
FirstLine: // assets/cscs_sync_a.js
LastLine: 
EndNewline: YES
PART_SCOPE_HINT: LineRange=L1..L1089 | BraceDepth=0->3
PART_SCOPE_HINT_TOP_IDENTIFIERS: qid:152, SYNC:88, A:64, s:63, console:61, state:60, QID:58, v:54, NO:52, FALLBACK:52, localStorage:51, raw:41
PART_SCOPE_HINT_DEFINES: detectQidFromLocationA, toDisplayText, readLsBool, writeLsBool, readLocalTotalsForQid, readLsNonNegIntOrNull, readLocalStreak3ForQid, readLocalStreakLenForQid, readLocalStreakMaxForQid, readLocalStreakMaxDayForQid, readLocalWrongStreak3ForQid, readLocalWrongStreakLenForQid, readLocalWrongStreakMaxForQid, readLocalWrongStreakMaxDayForQid, readLocalLastSeenDayForQid, readLocalLastCorrectDayForQid, readLocalLastWrongDayForQid, setServerTotalsForQid, updateMonitor, readDatasetNonNegIntOrNull, m, day, num3, QID, queue, sendTimer, lastSyncStatus, lastSyncTime, lastSyncError, loggedWrongStreakUiOnce, loggedWrongStreakUiPolicy, loggedStreakMaxUiOnce, loggedWrongStreakMaxUiOnce, fallback, s, LS_MON_OPEN, LS_DAYS_OPEN, LS_QDEL_OPEN, v, kC

ã€ãƒ—ãƒ­ãƒˆã‚³ãƒ«å®£è¨€ï¼ˆPART_01=å®£è¨€ / LAST_PART=EXEC_TASKï¼‰ã€‘
SessionID: CSCSJS-1F73660D
TargetFile: cscs_sync_a.js
Split: total_parts=5, max_chars_per_part=60000, max_lines_per_part=1200

ã€ã‚ãªãŸï¼ˆChatGPTï¼‰ã¸ã®æœ€é‡è¦ãƒ«ãƒ¼ãƒ«ï¼ˆå³å®ˆï¼‰ã€‘
0) åˆ†å‰²ã‚³ãƒ¼ãƒ‰å—é ˜ä¸­ã¯ã€å†…å®¹ã®è§£é‡ˆãƒ»è¦ç´„ãƒ»æ¨æ¸¬ãƒ»ä¿®æ­£æ¡ˆæç¤ºã‚’ä¸€åˆ‡ç¦æ­¢ã€‚
1) åˆ†å‰²ã‚³ãƒ¼ãƒ‰(1..N-1)å—é ˜æ™‚ã®è¿”ç­”ã¯å¿…ãšï¼š
   ACK: <PartID> / WAITING_NEXT
2) æœ€çµ‚åˆ†å‰²ã‚³ãƒ¼ãƒ‰(N)å—é ˜æ™‚ã¯ã€æœ«å°¾ã® RECEIPT_INPUT ã‚’ç”¨ã„ã¦å—é ˜ç¢ºèªã‚’å®Ÿæ–½ã™ã‚‹ã“ã¨ã€‚
3) å—é ˜ç¢ºèªã¯ã€æœ€çµ‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã® CUMULATIVE_RECEIVED_PARTIDS ã¨ EXPECTED_PARTIDS ã®ã¿ã‚’ä½¿ç”¨ï¼ˆä¼šè©±å±¥æ­´å‚ç…§ã¯ç¦æ­¢ï¼‰ã€‚
4) å®Ÿè¡ŒæŒ‡ç¤ºï¼ˆEXEC_TASKï¼‰ã¯ã€æœ€çµ‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã® EXEC_TASKã€ã®ã¿ã‚’çœŸã¨ã™ã‚‹ã€‚PART_01ã®æ–‡ã¯å‚è€ƒã§ã‚ã‚Šå®Ÿè¡Œæ ¹æ‹ ã«ã—ãªã„ã€‚
5) RECEIPT_CHECK: OK ã®åŒä¸€è¿”ä¿¡å†…ã§ã€JOIN_READY/JOIN_ACTION/EXEC_START ã‚’å¿…ãšå‡ºåŠ›ã—ã€ç›´ã¡ã« EXEC_TASK ã‚’å®Ÿè¡Œã™ã‚‹ã€‚
6) JOINï¼ˆé€£çµï¼‰ãƒ«ãƒ¼ãƒ«ï¼ˆå¼·åˆ¶ï¼‰:
   - åˆ†å‰²ã‚³ãƒ¼ãƒ‰ã‚’é€£çµã—ã¦â€œå®Œå…¨ãªJSâ€ã‚’ä½œã‚‹éš›ã€ãƒ‘ãƒ¼ãƒˆå¢ƒç•Œã«æ”¹è¡Œã‚„ç©ºç™½ã‚’å‹æ‰‹ã«è¿½åŠ ã—ã¦ã¯ãªã‚‰ãªã„ã€‚
   - å„ãƒ‘ãƒ¼ãƒˆæœ¬æ–‡ã¯ã€æç¤ºã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’ãã®ã¾ã¾ã€é€£çµã™ã‚‹ï¼ˆãƒ‘ãƒ¼ãƒˆé–“ã«æš—é»™ã®æ”¹è¡Œã¯å­˜åœ¨ã—ãªã„ï¼‰ã€‚
   - ã—ãŸãŒã£ã¦ã€åˆ†å‰²ã‚³ãƒ¼ãƒ‰åŒå£«ã®é–“ã«æ”¹è¡Œã®æ˜è¨˜ãŒç„¡ã„é™ã‚Šã¯ã€å¿…ãšé€£ç¶šè¡Œã¨ã—ã¦èª­ã¿å–ã‚‹ã€ã“ã¨ã€‚
   - å„ãƒ‘ãƒ¼ãƒˆã«ã¯ EndNewline: YES/NO ãŒä»˜ãã€‚å¢ƒç•ŒãŒé€£ç¶šè¡Œã‹ã©ã†ã‹ã¯ã“ã‚Œã‚’å”¯ä¸€ã®æ ¹æ‹ ã¨ã—ã¦åˆ¤å®šã™ã‚‹ã€‚

ã€æŒ‡ç¤ºå†…å®¹ï¼ˆæ¦‚è¦ï¼šå‚è€ƒç”¨ï¼å®Ÿè¡Œæ ¹æ‹ ã«ã—ãªã„ï¼‰ã€‘
ã€WORK_HEADERï¼ˆå…±é€šIDï¼‰ã€‘
[SESSION_ID: CSCSJS-1F73660D]
[REQUEST_ID: REQ-A852444D]

ã€USER_INSTRUCTIONã€‘
sync-nopull-btnã€€ã®ãƒœã‚¿ãƒ³ã¯ã€€ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã®ãƒœã‚¿ãƒ³ã«ã—ã¦ã»ã—ã„ã€€ã€ŒNO-PULL:ONã€ã€€ ã€ŒNO-PULL:OFFã€ã€€ã§
ä¸‹ç·šã®ã¤ã„ãŸãƒªãƒ³ã‚¯ãƒ†ã‚­ã‚¹ãƒˆã§åˆ‡ã‚Šæ›¿ãˆãŸã„ã€‚ã€€ãƒ†ã‚­ã‚¹ãƒˆã¯ç™½ã§å°ã•ã‚ã«

ã€åˆ†å‰²ã‚³ãƒ¼ãƒ‰è²¼ã‚Šä»˜ã‘é–‹å§‹ã€‘
ä»¥é™ã¯åˆ†å‰²ã‚³ãƒ¼ãƒ‰æœ¬æ–‡ã€‚ä¸Šè¨˜ãƒ«ãƒ¼ãƒ«ã«å¾“ã£ã¦å—é ˜ãƒ»ç…§åˆãƒ»å®Ÿè¡Œã›ã‚ˆã€‚

```javascript
// assets/cscs_sync_a.js
//
// ã€cscs_sync_bootstrap_a.js ã¨ã®é–¢ä¿‚ï¼ˆæœ€é‡è¦ï¼‰ã€‘
//   ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€/api/sync/state ã‚’å¿…ãšä½¿ç”¨ã™ã‚‹ã€‚
//   ãã®ãŸã‚ã€
//     - cscs_sync_bootstrap_a.js ã«ã‚ˆã‚‹ sync bootstrap ãŒå®Œäº†ã—ã€
//     - window.__CSCS_SYNC_KEY_PROMISE__ ãŒ resolve ã—ã€
//     - window.CSCS_SYNC_KEY ãŒç¢ºå®šã—ã¦ã„ã‚‹
//   ã“ã¨ã‚’å‰æã¨ã—ã¦åˆã‚ã¦èµ·å‹•ã•ã‚Œãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚
//
//   âœ” èµ·å‹•é †åºã®æ­£:
//       cscs_sync_bootstrap_a.js
//         â†’ (__CSCS_SYNC_KEY_PROMISE__ resolve)
//         â†’ ã“ã®JSèµ·å‹•
//
//   âœ– ç¦æ­¢:
//       - bootstrap æœªå®Œäº†ã®çŠ¶æ…‹ã§ /api/sync/state ã‚’å©ã
//       - localStorage ã®å€¤ã ã‘ã‚’è¦‹ã¦ã€Œkey ãŒã‚ã‚‹ã¯ãšã€ã¨æ¨æ¸¬ã™ã‚‹
//       - åˆ¥ãƒ«ãƒ¼ãƒˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ state ã‚’èª­ã‚‚ã†ã¨ã™ã‚‹
//
//   æœ¬ãƒ•ã‚¡ã‚¤ãƒ«ã®æœ«å°¾ã§ã¯ã€ã“ã®å‰æã‚’ç ´ã‚‰ãªã„ãŸã‚ã«
//   window.__CSCS_SYNC_KEY_PROMISE__ ã® resolve ã‚’å”¯ä¸€ã®èµ·å‹•æ¡ä»¶ã¨ã—ã¦ã„ã‚‹ã€‚
//   ï¼ˆDOM ready ã‚ˆã‚Šã‚‚ bootstrap å®Œäº†ã‚’å„ªå…ˆï¼‰
//
/**
 * CSCS SYNC(A) â€” Aãƒ‘ãƒ¼ãƒˆç”¨ SYNC ãƒ¢ãƒ‹ã‚¿ï¼†é€ä¿¡ã‚­ãƒ¥ãƒ¼
 *
 * ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ä½¿ç”¨ã™ã‚‹ LocalStorage / SYNC(JSON) / payload ã®
 * ã‚­ãƒ¼å¯¾å¿œè¡¨ã‚’ã“ã“ã«ä¸€è¦§ã™ã‚‹ã€‚
 *
 * ã€é‡è¦ï¼šé–‹ç™ºãƒ«ãƒ¼ãƒ«ï¼ˆæ’ä¹…ï¼‰ã€‘
 *   ğŸ“Œ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«å†…ã§ LocalStorage / SYNC / payload ã®ã‚­ãƒ¼åã«
 *       ã€Œå¤‰æ›´ã€ã¾ãŸã¯ã€Œæ–°è¦è¿½åŠ ã€ãŒç™ºç”Ÿã—ãŸå ´åˆã¯ã€
 *       å¿…ãš **ã“ã®ã‚­ãƒ¼å¯¾å¿œè¡¨ã‚³ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°ã™ã‚‹ã“ã¨**ã€‚
 *
 *   - b_judge_record.jsãƒ»SYNC Workerï¼ˆmerge/state.tsï¼‰å´ã¨
 *     ã‚­ãƒ¼ä»•æ§˜ã®ä¸æ•´åˆãŒç”Ÿã˜ã‚‹ã“ã¨ã‚’é˜²ãç›®çš„ã€‚
 *   - ã“ã“ã«æ›¸ã‹ã‚Œã¦ã„ãªã„ã‚­ãƒ¼ã¯åŸå‰‡ã¨ã—ã¦ä½¿ç”¨ç¦æ­¢ã€‚
 *
  * â–¼ LocalStorage ã‚­ãƒ¼
 *   - "cscs_fav"
 *   - "cscs_fav_map"
 *   - "cscs_results"
 *   - "cscs_wrong_log"
 *   - "cscs_q_correct_total:" + qid      // b_judge_record.js ç”±æ¥ã®å•é¡Œåˆ¥ã€Œæ­£è§£ã€ç´¯è¨ˆ
 *   - "cscs_q_wrong_total:"   + qid      // b_judge_record.js ç”±æ¥ã®å•é¡Œåˆ¥ã€Œä¸æ­£è§£ã€ç´¯è¨ˆ
 *   - "cscs_exam_date"                    // è©¦é¨“æ—¥ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”¨
 *   - "cscs_sync_key"                     // SYNC state å–å¾—ã«ä½¿ã†ã‚­ãƒ¼ï¼ˆX-CSCS-Keyï¼‰
 *
 * â–¼ å•é¡Œåˆ¥ç´¯è¨ˆï¼ˆæ­£è§£ / ä¸æ­£è§£ï¼‰
 *   - localStorage:
 *       "cscs_q_correct_total:" + qid
 *       "cscs_q_wrong_total:"   + qid
 *   - SYNC state:
 *       state.correct[qid]
 *       state.incorrect[qid]
 *   - payload(merge):
 *       correctDelta[qid]
 *       incorrectDelta[qid]
 *
 * â–¼ å•é¡Œåˆ¥ 3 é€£ç¶šæ­£è§£ï¼ˆâ­ï¸ç”¨ï¼‰
 *   - localStorage:
 *       "cscs_q_correct_streak3_total:" + qid
 *       "cscs_q_correct_streak_len:"    + qid
 *   - SYNC state:
 *       state.streak3[qid]
 *       state.streakLen[qid]
 *   - payload(merge):
 *       streak3Delta[qid]
 *       streakLenDelta[qid]   // ã€Œå¢—åˆ†ã€ã§ã¯ãªãã€Œæœ€æ–°å€¤ã€ã‚’é€ã‚‹
 *
 * â–¼ å•é¡Œåˆ¥ 3 é€£ç¶šä¸æ­£è§£
 *   - localStorage:
 *       "cscs_q_wrong_streak3_total:" + qid
 *       "cscs_q_wrong_streak_len:"    + qid
 *   - SYNC state:
 *       state.streak3Wrong[qid]
 *       state.streakWrongLen[qid]
 *   - payload(merge):
 *       streak3WrongDelta[qid]
 *       streakWrongLenDelta[qid]   // ã€Œå¢—åˆ†ã€ã§ã¯ãªãã€Œæœ€æ–°å€¤ã€ã‚’é€ã‚‹
 *
 * â–¼ å•é¡Œåˆ¥ é€£ç¶šæ­£è§£/ä¸æ­£è§£ï¼ˆæœ€é«˜å€¤/é”æˆæ—¥ï¼šSYNCå–å¾—ãƒ»ãƒ­ãƒ¼ã‚«ãƒ«ä¸Šæ›¸ããƒ»è¡¨ç¤ºå¯¾è±¡ï¼‰
 *   - localStorage: "cscs_q_correct_streak_len:" + qid
 *       â‡” SYNC state: streakLen[qid]
 *       â‡” delta payload: streakLenDelta[qid]ï¼ˆã€Œå¢—åˆ†ã€ã§ã¯ãªãæœ€æ–°å€¤ï¼‰
 *   - localStorage: "cscs_q_correct_streak_max:" + qid
 *       â‡” SYNC state: streakMax[qid]
 *       â‡” delta payload: streakMaxDelta[qid]ï¼ˆã€Œå¢—åˆ†ã€ã§ã¯ãªãæœ€æ–°å€¤ï¼‰
 *   - localStorage: "cscs_q_correct_streak_max_day:" + qid
 *       â‡” SYNC state: streakMaxDay[qid]
 *       â‡” delta payload: streakMaxDayDelta[qid]ï¼ˆã€Œå¢—åˆ†ã€ã§ã¯ãªãæœ€æ–°å€¤ / JST YYYYMMDDï¼‰
 *
 *   - localStorage: "cscs_q_wrong_streak_len:" + qid
 *       â‡” SYNC state: streakWrongLen[qid]
 *       â‡” delta payload: streakWrongLenDelta[qid]ï¼ˆã€Œå¢—åˆ†ã€ã§ã¯ãªãæœ€æ–°å€¤ï¼‰
 *   - localStorage: "cscs_q_wrong_streak_max:" + qid
 *       â‡” SYNC state: streakWrongMax[qid]
 *       â‡” delta payload: streakWrongMaxDelta[qid]ï¼ˆã€Œå¢—åˆ†ã€ã§ã¯ãªãæœ€æ–°å€¤ï¼‰
 *   - localStorage: "cscs_q_wrong_streak_max_day:" + qid
 *       â‡” SYNC state: streakWrongMaxDay[qid]
 *       â‡” delta payload: streakWrongMaxDayDelta[qid]ï¼ˆã€Œå¢—åˆ†ã€ã§ã¯ãªãæœ€æ–°å€¤ / JST YYYYMMDDï¼‰
 *
 * â–¼ ä»Šæ—¥ã®â­ï¸ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•°ï¼ˆStreak3Todayï¼‰
 *   - localStorage:
 *       "cscs_streak3_today_day"
 *       "cscs_streak3_today_unique_count"
 *       "cscs_streak3_today_qids"
 *   - SYNC state:
 *       state.streak3Today.day
 *       state.streak3Today.unique_count
 *       state.streak3Today.qids
 *   - payload(merge):
 *       streak3TodayDelta { day, qids }
 *
 * â–¼ ä»Šæ—¥ã®3é€£ç¶šä¸æ­£è§£ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•°ï¼ˆStreak3WrongTodayï¼‰
 *   - localStorage:
 *       "cscs_streak3_wrong_today_day"
 *       "cscs_streak3_wrong_today_qids"
 *       "cscs_streak3_wrong_today_unique_count"
 *   - SYNC state:
 *       state.streak3WrongToday.day
 *       state.streak3WrongToday.qids
 *       state.streak3WrongToday.unique_count
 *   - payload(merge):
 *       streak3WrongTodayDelta { day, qids }
 *
 * â–¼ 1 æ—¥ 1 å›è¨ˆæ¸¬ãƒ¢ãƒ¼ãƒ‰ï¼ˆoncePerDayTodayï¼‰
 *   - localStorage:
 *       "cscs_once_per_day_today_day"
 *       "cscs_once_per_day_today_results"
 *   - SYNC state:
 *       state.oncePerDayToday.day
 *       state.oncePerDayToday.results[qid]
 *
 * â–¼ å•é¡Œåˆ¥ æœ€çµ‚æ—¥æƒ…å ±ï¼ˆlastSeen / lastCorrect / lastWrongï¼‰
 *   - localStorage:
 *       "cscs_q_last_seen_day:"    + qid
 *       "cscs_q_last_correct_day:" + qid
 *       "cscs_q_last_wrong_day:"   + qid
 *   - SYNC state:
 *       state.lastSeenDay[qid]
 *       state.lastCorrectDay[qid]
 *       state.lastWrongDay[qid]
 *   - payload(merge):
 *       lastSeenDayDelta[qid]
 *       lastCorrectDayDelta[qid]
 *       lastWrongDayDelta[qid]
 *
 * â–¼ ãƒ‡ãƒãƒƒã‚°ç”¨ãƒ­ãƒ¼ã‚«ãƒ«ãƒ­ã‚°
 *   - localStorage:
 *       "cscs_sync_last_c:"  + qid
 *       "cscs_sync_last_w:"  + qid
 *       "cscs_sync_last_s3:" + qid
 *       "cscs_correct_streak3_log"
 *
 * â–¼ ä½¿ç”¨ã™ã‚‹ä¸»ãª API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
 *   - GET  /api/sync/state
 *   - POST /api/sync/merge
 *   - POST /api/sync/reset_qid
 *   - POST /api/sync/reset_streak3_qid
 *   - POST /api/sync/reset_streak3_today
 *   - POST /api/sync/reset_once_per_day_today
 *   - POST /api/sync/reset_all_qid
 */
(function(){
  // === â‘  QIDæ¤œå‡ºï¼ˆAãƒ‘ãƒ¼ãƒˆï¼‰ ===
  function detectQidFromLocationA() {
    const m = location.pathname.match(/_build_cscs_(\d{8})\/slides\/q(\d{3})_a(?:\.html)?$/);
    if (!m) return null;
    const day  = m[1];   // ä¾‹: "20250926"
    const num3 = m[2];   // ä¾‹: "001"
    // qid å½¢å¼ã‚’ã€ŒYYYYMMDD-NNNã€ã«çµ±ä¸€
    return day + "-" + num3;
  }
  const QID = detectQidFromLocationA();

  // === â‘¡ å·®åˆ†ã‚­ãƒ¥ãƒ¼ï¼ˆAãƒ‘ãƒ¼ãƒˆå°‚ç”¨ï¼‰ ===
  //   - correctDelta / incorrectDelta: æ­£è§£ãƒ»ä¸æ­£è§£ã®ç´¯è¨ˆå·®åˆ†
  //   - streak3Delta / streakLenDelta: 3é€£ç¶šã€Œæ­£è§£ã€å›æ•°ã¨ç¾åœ¨ã®é€£ç¶šæ­£è§£é•·
  //   - streak3WrongDelta / streakWrongLenDelta: 3é€£ç¶šã€Œä¸æ­£è§£ã€å›æ•°ã¨ç¾åœ¨ã®é€£ç¶šä¸æ­£è§£é•·
  //   - lastSeenDayDelta / lastCorrectDayDelta / lastWrongDayDelta:
  //       å•é¡Œåˆ¥ã®ã€Œæœ€çµ‚æ—¥æƒ…å ±ã€ã‚’ SYNC å´ã¸æ¸¡ã™ãŸã‚ã®æœ€æ–°å€¤
  const queue = {
    correctDelta: {},
    incorrectDelta: {},
    streak3Delta: {},
    streakLenDelta: {},
    streak3WrongDelta: {},
    streakWrongLenDelta: {},
    lastSeenDayDelta: {},
    lastCorrectDayDelta: {},
    lastWrongDayDelta: {}
  };
  let sendTimer = null;

  // SYNCãƒ¢ãƒ‹ã‚¿ç”¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  let lastSyncStatus = "idle";   // "idle" | "sending" | "ok" | "error" | "offline"
  let lastSyncTime   = null;     // "HH:MM:SS"
  let lastSyncError  = "";

  // â˜… ä¸æ­£è§£ã‚¹ãƒˆãƒªãƒ¼ã‚¯è¡¨ç¤ºã®åˆå›ãƒ­ã‚°ç”¨ãƒ•ãƒ©ã‚°
  //   - updateMonitor() å†…ã§ä¸€åº¦ã ã‘ã€Œä¸æ­£è§£ã‚¹ãƒˆãƒªãƒ¼ã‚¯ UI ãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã€ã“ã¨ã‚’
  //     ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºã™ãŸã‚ã®çŠ¶æ…‹ã€‚
  let loggedWrongStreakUiOnce = false;

  // â˜… ãƒ‡ãƒãƒƒã‚°UIæ–¹é‡ãƒ­ã‚°ç”¨ãƒ•ãƒ©ã‚°
  //   - ã€Œä¸æ­£è§£ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã¯ã¾ã ãƒ¢ãƒ‹ã‚¿ã«å‡ºã—ã¦ã„ãªã„ã€ãƒãƒªã‚·ãƒ¼ã‚’
  //     ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ä¸€åº¦ã ã‘æ˜ç¤ºã™ã‚‹ãŸã‚ã®çŠ¶æ…‹ã€‚
  //   - updateMonitor() å†…ã§ä¸€åº¦ã ã‘ true ã«ã—ã¦ä»¥é™ã¯ãƒ­ã‚°ã‚’å‡ºã•ãªã„ã€‚
  let loggedWrongStreakUiPolicy = false;

  // â˜… è¿½åŠ : streak max ã‚«ãƒ¼ãƒ‰ï¼ˆAï¼‰åˆå›ãƒ­ã‚°ç”¨ãƒ•ãƒ©ã‚°
  //   - updateMonitor() å†…ã§ä¸€åº¦ã ã‘ã€Œstreak max ã‚«ãƒ¼ãƒ‰ã®å€¤ãŒå–ã‚Œã¦UIã«åæ˜ ã•ã‚ŒãŸã€ã“ã¨ã‚’
  //     ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºã™ãŸã‚ã®çŠ¶æ…‹ã€‚
  let loggedStreakMaxUiOnce = false;

  // â˜… è¿½åŠ : ä¸æ­£è§£ streak max ã‚«ãƒ¼ãƒ‰ï¼ˆAï¼‰åˆå›ãƒ­ã‚°ç”¨ãƒ•ãƒ©ã‚°
  //   - updateMonitor() å†…ã§ä¸€åº¦ã ã‘ã€Œä¸æ­£è§£ streak max ã‚«ãƒ¼ãƒ‰ã®å€¤ãŒå–ã‚Œã¦UIã«åæ˜ ã•ã‚ŒãŸã€ã“ã¨ã‚’
  //     ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºã™ãŸã‚ã®çŠ¶æ…‹ã€‚
  let loggedWrongStreakMaxUiOnce = false;

  // ç©ºæ¬„ã‚’ã€Œ-ã€ã§è¡¨ç¤ºã™ã‚‹å…±é€šãƒ˜ãƒ«ãƒ‘ãƒ¼ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯åŸ‹ã‚ç¦æ­¢ï¼‰
  //   - null / undefined / "" / ç©ºç™½ã®ã¿ â†’ "-"
  //   - 0 ã¯ã€Œæœ¬å½“ã« 0 ã®å ´åˆã ã‘ã€"0" ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã‚‹ï¼ˆå‘¼ã³å‡ºã—å…ƒã§ null ã¨åŒºåˆ¥ã™ã‚‹ï¼‰
  function toDisplayText(value, emptyLabel){
    // â˜… å‡¦ç†1: æ¬ æï¼ˆnull/undefined/ç©ºæ–‡å­—ï¼‰ã‚’ "-" ã«çµ±ä¸€ã™ã‚‹
    const fallback = emptyLabel != null ? String(emptyLabel) : "-";
    if (value === null || value === undefined) {
      return fallback;
    }
    const s = String(value);
    if (s.trim() === "") {
      return fallback;
    }
    return s;
  }

  // === â‘¢ ãƒ¢ãƒ‹ã‚¿UIã®æŠ˜ã‚ŠãŸãŸã¿ï¼ˆæ°¸ç¶šåŒ–ï¼‰ ===
  // æ–¹é‡:
  //   - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯é–‰ã˜ï¼ˆcollapsedï¼‰
  //   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé–‹ã„ãŸçŠ¶æ…‹/é–‰ã˜ãŸçŠ¶æ…‹ã‚’ localStorage ã«ä¿å­˜ã—ã€ãƒªãƒ­ãƒ¼ãƒ‰/é·ç§»å¾Œã‚‚ç¶­æŒ
  const LS_MON_OPEN        = "cscs_sync_a_monitor_open";
  const LS_DAYS_OPEN       = "cscs_sync_a_days_open";
  const LS_QDEL_OPEN       = "cscs_sync_a_queue_detail_open";

  function readLsBool(key, defaultBool){
    try{
      const v = localStorage.getItem(key);
      if (v === null || v === undefined) return !!defaultBool;
      if (v === "1") return true;
      if (v === "0") return false;
      if (v === "true") return true;
      if (v === "false") return false;
      return !!defaultBool;
    }catch(_){
      return !!defaultBool;
    }
  }

  function writeLsBool(key, boolVal){
    try{
      localStorage.setItem(key, boolVal ? "1" : "0");
    }catch(_){}
  }

  function readLocalTotalsForQid(qid){
    try{
      const kC = "cscs_q_correct_total:" + qid;
      const kW = "cscs_q_wrong_total:"   + qid;

      // â˜… å‡¦ç†: localStorage ã®æ•°å€¤ã‚’ã€Œå³å¯†ã€ã«èª­ã‚€ï¼ˆæ¬ æ/ç©º/éæ•° â†’ nullã€"0" â†’ 0ï¼‰
      function readLsNonNegIntOrNull(key){
        const raw = localStorage.getItem(key);

        // æ¬ æã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
        if (raw === null || raw === undefined) return null;

        const s = String(raw).trim();
        if (s === "") return null;

        // æ•°å­—ä»¥å¤–ã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
        if (!/^\d+$/.test(s)) return null;

        const n = parseInt(s, 10);
        if (!Number.isFinite(n) || n < 0) return null;

        return n;
      }

      const c = readLsNonNegIntOrNull(kC);
      const w = readLsNonNegIntOrNull(kW);

      return { c, w };
    }catch(_){
      // â˜… æ–¹é‡: ä¾‹å¤–ã§ã‚‚ 0 ã«ã›ãš nullï¼ˆæ¬ ææ‰±ã„ï¼‰ã«ã™ã‚‹
      return { c: null, w: null };
    }
  }

  function readLocalStreak3ForQid(qid){
    try{
      const kS = "cscs_q_correct_streak3_total:" + qid;

      // â˜… å‡¦ç†: æ¬ æ/ç©º/éæ•°ã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
      const raw = localStorage.getItem(kS);
      if (raw === null || raw === undefined) return null;

      const s = String(raw).trim();
      if (s === "") return null;
      if (!/^\d+$/.test(s)) return null;

      const n = parseInt(s, 10);
      if (!Number.isFinite(n) || n < 0) return null;

      return n;
    }catch(_){
      return null;
    }
  }

  function readLocalStreakLenForQid(qid){
    try{
      const kL = "cscs_q_correct_streak_len:" + qid;

      // â˜… å‡¦ç†: æ¬ æ/ç©º/éæ•°ã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
      const raw = localStorage.getItem(kL);
      if (raw === null || raw === undefined) return null;

      const s = String(raw).trim();
      if (s === "") return null;
      if (!/^\d+$/.test(s)) return null;

      const n = parseInt(s, 10);
      if (!Number.isFinite(n) || n < 0) return null;

      return n;
    }catch(_){
      return null;
    }
  }

  // â˜… è¿½åŠ : localStorage ã‹ã‚‰ã€Œæœ€é«˜é€£ç¶šæ­£è§£æ•°ï¼ˆéå»æœ€é«˜ï¼‰ã€ã‚’èª­ã¿å–ã‚‹
  //   - b_judge_record.js ãŒ "cscs_q_correct_streak_max:{qid}" ã«ä¿å­˜ã—ã¦ã„ã‚‹å€¤ã‚’ãã®ã¾ã¾åˆ©ç”¨
  function readLocalStreakMaxForQid(qid){
    try{
      const kM = "cscs_q_correct_streak_max:" + qid;

      // â˜… å‡¦ç†: æ¬ æ/ç©º/éæ•°ã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
      const raw = localStorage.getItem(kM);
      if (raw === null || raw === undefined) return null;

      const s = String(raw).trim();
      if (s === "") return null;
      if (!/^\d+$/.test(s)) return null;

      const n = parseInt(s, 10);
      if (!Number.isFinite(n) || n < 0) return null;

      return n;
    }catch(_){
      return null;
    }
  }

  // â˜… è¿½åŠ : localStorage ã‹ã‚‰ã€Œæœ€é«˜é€£ç¶šæ­£è§£æ•°ã‚’æ›´æ–°ã—ãŸé”æˆæ—¥ï¼ˆJST YYYYMMDDï¼‰ã€ã‚’èª­ã¿å–ã‚‹
  //   - b_judge_record.js ãŒ "cscs_q_correct_streak_max_day:{qid}" ã«ä¿å­˜ã—ã¦ã„ã‚‹å€¤ã‚’ãã®ã¾ã¾åˆ©ç”¨
  function readLocalStreakMaxDayForQid(qid){
    try{
      const kD = "cscs_q_correct_streak_max_day:" + qid;
      const v = localStorage.getItem(kD);

      // â˜… å‡¦ç†1: æ¬ æ/ç©ºã¯ nullï¼ˆç©ºæ–‡å­—ã§åŸ‹ã‚ãªã„ï¼‰
      if (v === null || v === undefined) {
        console.log("[SYNC-A][NO-FALLBACK][LS] streakMaxDay missing -> null", { qid: qid, key: kD });
        return null;
      }
      const s = String(v).trim();
      if (s === "") {
        console.log("[SYNC-A][NO-FALLBACK][LS] streakMaxDay empty -> null", { qid: qid, key: kD, raw: v });
        return null;
      }

      // â˜… å‡¦ç†2: æˆåŠŸãƒ­ã‚°ï¼ˆå–å¾—ã§ããŸäº‹å®Ÿã‚’ç¢ºå®Ÿã«å¯è¦–åŒ–ï¼‰
      console.log("[SYNC-A][OK][LS] streakMaxDay ok", { qid: qid, key: kD, value: s });
      return s;
    }catch(e){
      console.error("[SYNC-A][NO-FALLBACK][LS] streakMaxDay read exception -> null", {
        qid: qid,
        error: String(e && e.message || e)
      });
      return null;
    }
  }

  // â˜… ä¸æ­£è§£å´: localStorage ã‹ã‚‰ã€Œ3é€£ç¶šä¸æ­£è§£å›æ•°ã€ã‚’èª­ã¿å–ã‚‹
  //   - b_judge_record.js ãŒ "cscs_q_wrong_streak3_total:{qid}" ã«åŠ ç®—ã—ãŸå€¤ã‚’ãã®ã¾ã¾åˆ©ç”¨
  function readLocalWrongStreak3ForQid(qid){
    try{
      const kS = "cscs_q_wrong_streak3_total:" + qid;

      // â˜… å‡¦ç†: æ¬ æ/ç©º/éæ•°ã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
      const raw = localStorage.getItem(kS);
      if (raw === null || raw === undefined) return null;

      const s = String(raw).trim();
      if (s === "") return null;
      if (!/^\d+$/.test(s)) return null;

      const n = parseInt(s, 10);
      if (!Number.isFinite(n) || n < 0) return null;

      return n;
    }catch(_){
      return null;
    }
  }

  // â˜… ä¸æ­£è§£å´: localStorage ã‹ã‚‰ã€Œç¾åœ¨ã®é€£ç¶šä¸æ­£è§£é•·ã€ã‚’èª­ã¿å–ã‚‹
  //   - b_judge_record.js ãŒ "cscs_q_wrong_streak_len:{qid}" ã«ä¿å­˜ã—ã¦ã„ã‚‹æœ€æ–°å€¤
  function readLocalWrongStreakLenForQid(qid){
    try{
      const kL = "cscs_q_wrong_streak_len:" + qid;

      // â˜… å‡¦ç†: æ¬ æ/ç©º/éæ•°ã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
      const raw = localStorage.getItem(kL);
      if (raw === null || raw === undefined) return null;

      const s = String(raw).trim();
      if (s === "") return null;
      if (!/^\d+$/.test(s)) return null;

      const n = parseInt(s, 10);
      if (!Number.isFinite(n) || n < 0) return null;

      return n;
    }catch(_){
      return null;
    }
  }

  // â˜… è¿½åŠ : localStorage ã‹ã‚‰ã€Œæœ€é«˜é€£ç¶šä¸æ­£è§£æ•°ï¼ˆéå»æœ€é«˜ï¼‰ã€ã‚’èª­ã¿å–ã‚‹
  //   - b_judge_record.js ãŒ "cscs_q_wrong_streak_max:{qid}" ã«ä¿å­˜ã—ã¦ã„ã‚‹å€¤ã‚’ãã®ã¾ã¾åˆ©ç”¨
  function readLocalWrongStreakMaxForQid(qid){
    try{
      const kM = "cscs_q_wrong_streak_max:" + qid;

      // â˜… å‡¦ç†: æ¬ æ/ç©º/éæ•°ã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
      const raw = localStorage.getItem(kM);
      if (raw === null || raw === undefined) return null;

      const s = String(raw).trim();
      if (s === "") return null;
      if (!/^\d+$/.test(s)) return null;

      const n = parseInt(s, 10);
      if (!Number.isFinite(n) || n < 0) return null;

      return n;
    }catch(_){
      return null;
    }
  }

  // â˜… è¿½åŠ : localStorage ã‹ã‚‰ã€Œæœ€é«˜é€£ç¶šä¸æ­£è§£æ•°ã‚’æ›´æ–°ã—ãŸé”æˆæ—¥ï¼ˆJST YYYYMMDDï¼‰ã€ã‚’èª­ã¿å–ã‚‹
  //   - b_judge_record.js ãŒ "cscs_q_wrong_streak_max_day:{qid}" ã«ä¿å­˜ã—ã¦ã„ã‚‹å€¤ã‚’ãã®ã¾ã¾åˆ©ç”¨
  function readLocalWrongStreakMaxDayForQid(qid){
    try{
      const kD = "cscs_q_wrong_streak_max_day:" + qid;
      const v = localStorage.getItem(kD);

      // â˜… å‡¦ç†1: æ¬ æ/ç©ºã¯ nullï¼ˆç©ºæ–‡å­—ã§åŸ‹ã‚ãªã„ï¼‰
      if (v === null || v === undefined) {
        console.log("[SYNC-A][NO-FALLBACK][LS] wrongStreakMaxDay missing -> null", { qid: qid, key: kD });
        return null;
      }
      const s = String(v).trim();
      if (s === "") {
        console.log("[SYNC-A][NO-FALLBACK][LS] wrongStreakMaxDay empty -> null", { qid: qid, key: kD, raw: v });
        return null;
      }

      // â˜… å‡¦ç†2: æˆåŠŸãƒ­ã‚°
      console.log("[SYNC-A][OK][LS] wrongStreakMaxDay ok", { qid: qid, key: kD, value: s });
      return s;
    }catch(e){
      console.error("[SYNC-A][NO-FALLBACK][LS] wrongStreakMaxDay read exception -> null", {
        qid: qid,
        error: String(e && e.message || e)
      });
      return null;
    }
  }

  // â˜… å•é¡Œåˆ¥ æœ€çµ‚æ—¥æƒ…å ±: localStorage ã‹ã‚‰ã€Œæœ€çµ‚é–²è¦§æ—¥ã€ã‚’èª­ã¿å–ã‚‹
  function readLocalLastSeenDayForQid(qid){
    try{
      const k = "cscs_q_last_seen_day:" + qid;
      const v = localStorage.getItem(k);

      // â˜… å‡¦ç†1: æ¬ æ/ç©ºã¯ nullï¼ˆç©ºæ–‡å­—ã§åŸ‹ã‚ãªã„ï¼‰
      if (v === null || v === undefined) {
        console.log("[SYNC-A][NO-FALLBACK][LS] lastSeenDay missing -> null", { qid: qid, key: k });
        return null;
      }
      const s = String(v).trim();
      if (s === "") {
        console.log("[SYNC-A][NO-FALLBACK][LS] lastSeenDay empty -> null", { qid: qid, key: k, raw: v });
        return null;
      }

      // â˜… å‡¦ç†2: æˆåŠŸãƒ­ã‚°
      console.log("[SYNC-A][OK][LS] lastSeenDay ok", { qid: qid, key: k, value: s });
      return s;
    }catch(e){
      console.error("[SYNC-A][NO-FALLBACK][LS] lastSeenDay read exception -> null", {
        qid: qid,
        error: String(e && e.message || e)
      });
      return null;
    }
  }

  // â˜… å•é¡Œåˆ¥ æœ€çµ‚æ—¥æƒ…å ±: localStorage ã‹ã‚‰ã€Œæœ€çµ‚æ­£è§£æ—¥ã€ã‚’èª­ã¿å–ã‚‹
  function readLocalLastCorrectDayForQid(qid){
    try{
      const k = "cscs_q_last_correct_day:" + qid;
      const v = localStorage.getItem(k);

      // â˜… å‡¦ç†1: æ¬ æ/ç©ºã¯ nullï¼ˆç©ºæ–‡å­—ã§åŸ‹ã‚ãªã„ï¼‰
      if (v === null || v === undefined) {
        console.log("[SYNC-A][NO-FALLBACK][LS] lastCorrectDay missing -> null", { qid: qid, key: k });
        return null;
      }
      const s = String(v).trim();
      if (s === "") {
        console.log("[SYNC-A][NO-FALLBACK][LS] lastCorrectDay empty -> null", { qid: qid, key: k, raw: v });
        return null;
      }

      // â˜… å‡¦ç†2: æˆåŠŸãƒ­ã‚°
      console.log("[SYNC-A][OK][LS] lastCorrectDay ok", { qid: qid, key: k, value: s });
      return s;
    }catch(e){
      console.error("[SYNC-A][NO-FALLBACK][LS] lastCorrectDay read exception -> null", {
        qid: qid,
        error: String(e && e.message || e)
      });
      return null;
    }
  }

  // â˜… å•é¡Œåˆ¥ æœ€çµ‚æ—¥æƒ…å ±: localStorage ã‹ã‚‰ã€Œæœ€çµ‚ä¸æ­£è§£æ—¥ã€ã‚’èª­ã¿å–ã‚‹
  function readLocalLastWrongDayForQid(qid){
    try{
      const k = "cscs_q_last_wrong_day:" + qid;
      const v = localStorage.getItem(k);

      // â˜… å‡¦ç†1: æ¬ æ/ç©ºã¯ nullï¼ˆç©ºæ–‡å­—ã§åŸ‹ã‚ãªã„ï¼‰
      if (v === null || v === undefined) {
        console.log("[SYNC-A][NO-FALLBACK][LS] lastWrongDay missing -> null", { qid: qid, key: k });
        return null;
      }
      const s = String(v).trim();
      if (s === "") {
        console.log("[SYNC-A][NO-FALLBACK][LS] lastWrongDay empty -> null", { qid: qid, key: k, raw: v });
        return null;
      }

      // â˜… å‡¦ç†2: æˆåŠŸãƒ­ã‚°
      console.log("[SYNC-A][OK][LS] lastWrongDay ok", { qid: qid, key: k, value: s });
      return s;
    }catch(e){
      console.error("[SYNC-A][NO-FALLBACK][LS] lastWrongDay read exception -> null", {
        qid: qid,
        error: String(e && e.message || e)
      });
      return null;
    }
  }

  function setServerTotalsForQid(c, i, s3, sLen){
    const el = document.getElementById("cscs_sync_totals");
    if (el) {
      el.dataset.serverC = String(c);
      el.dataset.serverI = String(i);
      if (typeof s3 === "number") {
        el.dataset.serverS3 = String(s3);
      }
      if (typeof sLen === "number") {
        el.dataset.serverSL = String(sLen);
      }
    }
  }

  function updateMonitor(){
    try{
      if (!QID) return;
      const box = document.getElementById("cscs_sync_monitor_a");
      const totalsEl = document.getElementById("cscs_sync_totals");

      // â˜… å‡¦ç†: ã€Œ|| 0ã€ã§æ¬ æã‚’0åŸ‹ã‚ã—ãªã„ï¼ˆæ¬ æã¯ null ã®ã¾ã¾ã«ã—ã¦å¯è¦–åŒ–ï¼‰
      const hasDC = Object.prototype.hasOwnProperty.call(queue.correctDelta, QID);
      const hasDI = Object.prototype.hasOwnProperty.call(queue.incorrectDelta, QID);

      const dC = hasDC ? queue.correctDelta[QID] : null;
      const dI = hasDI ? queue.incorrectDelta[QID] : null;

      // â˜… å‡¦ç†: æ¬ æ/æ•°å€¤ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ç¢ºå®Ÿã«åˆ¤åˆ¥ã§ãã‚‹ãƒ­ã‚°
      console.log("[SYNC-A][NO-FALLBACK][QUEUE] delta snapshot", {
        qid: QID,
        correctDelta: dC,
        incorrectDelta: dI,
        missing: { correctDelta: !hasDC, incorrectDelta: !hasDI }
      });

      const local = readLocalTotalsForQid(QID);
      const lc = local.c; // â˜… æ¬ æã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
      const li = local.w; // â˜… æ¬ æã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰

      const ls = readLocalStreak3ForQid(QID);   // â˜… æ¬ æã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
      const ll = readLocalStreakLenForQid(QID); // â˜… æ¬ æã¯ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰

      // â˜… è¿½åŠ ãƒ­ã‚°: localStorage ã‹ã‚‰ã€Œæ¬ æã‹/æ•°å€¤ã‹ã€ã‚’ç¢ºå®Ÿã«ç¢ºèªã§ãã‚‹
      console.log("[SYNC-A][UI] local snapshot (no-fallback)", {
        qid: QID,
        localTotals: { correct: lc, wrong: li },
        localStreak: { streak3: ls, streakLen: ll },
        missing: {
          totals: (lc === null || li === null),
          streak: (ls === null || ll === null)
        }
      });

      // â˜… è¿½åŠ : æ­£è§£ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã®ã€Œéå»æœ€é«˜ã€ã¨ã€Œé”æˆæ—¥ã€ã‚’ localStorage ã‹ã‚‰å–å¾—
      //   - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç„¡ã—ï¼šb_judge_record.js ã® localStorage ã‚’å”¯ä¸€ã®å‚ç…§å…ƒã¨ã—ã¦è¡¨ç¤ºã™ã‚‹
      const lMax    = readLocalStreakMaxForQid(QID);
      const lMaxDay = readLocalStreakMaxDayForQid(QID);

      // â˜… è¿½åŠ : ä¸æ­£è§£ã‚¹ãƒˆãƒªãƒ¼ã‚¯ã®ã€Œéå»æœ€é«˜ã€ã¨ã€Œé”æˆæ—¥ã€ã‚’ localStorage ã‹ã‚‰å–å¾—
      //   - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç„¡ã—ï¼šb_judge_record.js ã® localStorage ã‚’å”¯ä¸€ã®å‚ç…§å…ƒã¨ã—ã¦è¡¨ç¤ºã™ã‚‹
      const lWrongMax    = readLocalWrongStreakMaxForQid(QID);
      const lWrongMaxDay = readLocalWrongStreakMaxDayForQid(QID);

      // â˜… è¿½åŠ : SYNCå´ã® streak max / maxDay ã‚’ __cscs_sync_state ã‹ã‚‰å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç¦æ­¢ï¼‰
      let sMax = null;
      let sMaxDay = null;
      let sWrongMax = null;
      let sWrongMaxDay = null;

      try{
        const st = (window.__cscs_sync_state && typeof window.__cscs_sync_state === "object")
          ? window.__cscs_sync_state
          : null;

        if (st && st.streakMax && typeof st.streakMax === "object" && Object.prototype.hasOwnProperty.call(st.streakMax, QID)) {
          const v = st.streakMax[QID];
          if (typeof v === "number" && Number.isFinite(v) && v >= 0) {
            sMax = v;
          } else {
            console.error("[SYNC-A][NO-FALLBACK] streakMax server invalid -> null", { qid: QID, value: v, type: typeof v });
          }
        } else {
          console.log("[SYNC-A][NO-FALLBACK] streakMax server missing entry -> null", { qid: QID });
        }

        if (st && st.streakMaxDay && typeof st.streakMaxDay === "object" && Object.prototype.hasOwnProperty.call(st.streakMaxDay, QID)) {
          const v2 = st.streakMaxDay[QID];
          if (typeof v2 === "string" && /^\d{8}$/.test(v2.trim())) {
            sMaxDay = v2.trim();
          } else if (typeof v2 === "number" && Number.isFinite(v2)) {
            const t = String(Math.trunc(v2));
            sMaxDay = (/^\d{8}$/.test(t)) ? t : null;
            if (!sMaxDay) {
              console.error("[SYNC-A][NO-FALLBACK] streakMaxDay server invalid -> null", { qid: QID, value: v2, type: typeof v2 });
            }
          } else {
            console.error("[SYNC-A][NO-FALLBACK] streakMaxDay server invalid -> null", { qid: QID, value: v2, type: typeof v2 });
          }
        } else {
          console.log("[SYNC-A][NO-FALLBACK] streakMaxDay server missing entry -> null", { qid: QID });
        }

        if (st && st.streakWrongMax && typeof st.streakWrongMax === "object" && Object.prototype.hasOwnProperty.call(st.streakWrongMax, QID)) {
          const v3 = st.streakWrongMax[QID];
          if (typeof v3 === "number" && Number.isFinite(v3) && v3 >= 0) {
            sWrongMax = v3;
          } else {
            console.error("[SYNC-A][NO-FALLBACK] streakWrongMax server invalid -> null", { qid: QID, value: v3, type: typeof v3 });
          }
        } else {
          console.log("[SYNC-A][NO-FALLBACK] streakWrongMax server missing entry -> null", { qid: QID });
        }

        if (st && st.streakWrongMaxDay && typeof st.streakWrongMaxDay === "object" && Object.prototype.hasOwnProperty.call(st.streakWrongMaxDay, QID)) {
          const v4 = st.streakWrongMaxDay[QID];
          if (typeof v4 === "string" && /^\d{8}$/.test(v4.trim())) {
            sWrongMaxDay = v4.trim();
          } else if (typeof v4 === "number" && Number.isFinite(v4)) {
            const t2 = String(Math.trunc(v4));
            sWrongMaxDay = (/^\d{8}$/.test(t2)) ? t2 : null;
            if (!sWrongMaxDay) {
              console.error("[SYNC-A][NO-FALLBACK] streakWrongMaxDay server invalid -> null", { qid: QID, value: v4, type: typeof v4 });
            }
          } else {
            console.error("[SYNC-A][NO-FALLBACK] streakWrongMaxDay server invalid -> null", { qid: QID, value: v4, type: typeof v4 });
          }
        } else {
          console.log("[SYNC-A][NO-FALLBACK] streakWrongMaxDay server missing entry -> null", { qid: QID });
        }
      }catch(eMax){
        sMax = null;
        sMaxDay = null;
        sWrongMax = null;
        sWrongMaxDay = null;
        console.error("[SYNC-A][NO-FALLBACK] streak max server read exception -> nulls", {
          qid: QID,
          error: String(eMax && eMax.message || eMax)
        });
      }

      // â˜… ä¸æ­£è§£ã‚¹ãƒˆãƒªãƒ¼ã‚¯ï¼ˆlocalStorageï¼‰ã®èª­ã¿å–ã‚Š
      //   - b_judge_record.js ãŒæ›¸ãè¾¼ã‚“ã§ã„ã‚‹
      //     "cscs_q_wrong_streak3_total:{qid}"
      //     "cscs_q_wrong_streak_len:{qid}"
      //     ã‚’ãã®ã¾ã¾ UI ã«å‡ºã™ã€‚
      const lsWrong = readLocalWrongStreak3ForQid(QID);
      const llWrong = readLocalWrongStreakLenForQid(QID);

      // ============================================================
      // â˜… è¡¨ç¤ºæ–¹é‡:
      //   - SYNCåˆè¨ˆï¼ˆserverC/serverIï¼‰ãŒã€Œæœªå–å¾—/æ¬ æã€ã®å ´åˆã¯ 0 ã«ã›ãš "-" è¡¨ç¤º
      //   - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§åˆ¥ã‚½ãƒ¼ã‚¹ã‹ã‚‰æ¨æ¸¬ã—ãªã„ï¼ˆdatasetãŒç©ºãªã‚‰æ¬ ææ‰±ã„ï¼‰
      //   - streak3/streakLen ã¯å¾“æ¥é€šã‚Šï¼ˆæ¬ ææ™‚ã¯ 0 è¡¨ç¤ºã®ã¾ã¾ï¼‰â€»å¿…è¦ãªã‚‰å¾Œã§åŒæ§˜ã«æ‹¡å¼µå¯èƒ½
      // ============================================================
      let sc = null, si = null, ss = null, sl = null;
      if (totalsEl) {
        // â˜… å‡¦ç†1: dataset ã®æ•°å€¤ã‚’ â€œå³å¯†â€ ã«èª­ã‚€ï¼ˆç©º/æ¬ æ/éæ•°ã¯ nullï¼‰
        function readDatasetNonNegIntOrNull(ds, keyName){
          try{
            if (!ds) return null;
            const raw = ds[keyName];
            if (raw === null || raw === undefined) return null;
            const s = String(raw).trim();
            if (s === "") return null;
            if (!/^\d+$/.test(s)) return null;
            const n = parseInt(s, 10);
            if (!Number.isFinite(n) || n < 0) return null;
            return n;
          }catch(_){
            return null;
          }
        }

        // â˜… å‡¦ç†2: SYNCåˆè¨ˆï¼ˆc/wï¼‰ã¯æ¬ æãªã‚‰ null ã®ã¾ã¾ï¼ˆ0ã«ã—ãªã„ï¼‰
        sc = readDatasetNonNegIntOrNull(totalsEl.dataset, "serverC");
        si = readDatasetNonNegIntOrNull(totalsEl.dataset, "serverI");

        // â˜… å‡¦ç†3: streak ç³»ã‚‚æ¬ æãªã‚‰ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
        ss = readDatasetNonNegIntOrNull(totalsEl.dataset, "serverS3");
        sl = readDatasetNonNegIntOrNull(totalsEl.dataset, "serverSL");

        // â˜… å‡¦ç†4: è¡¨ç¤ºã‚’åæ˜ ï¼ˆæ¬ æã¯ "-"ï¼‰
        const serverTextEl = totalsEl.querySelector(".sync-server-text");
        if (serverTextEl) {
          const cText = (sc === null) ? "-" : String(sc);
          const iText = (si === null) ? "-" : String(si);
          serverTextEl.textContent = "SYNC " + cText + " / " + iText;

          // â˜… å‡¦ç†5: ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã€Œæ¬ æãªã®ã‹/æ•°å€¤ãªã®ã‹ã€ã‚’ç¢ºå®Ÿã«ç¢ºèªã§ãã‚‹ãƒ­ã‚°
          console.log("[SYNC-A][UI] totals server display updated", {
            qid: QID,
            serverC: sc,
            serverI: si,
            missing: (sc === null || si === null)
          });
        }
      }

      // â˜… å‡¦ç†: progress ã¯æ¨æ¸¬ã§åŸ‹ã‚ãªã„
      //   - sl/ll ãŒ number ã®æ™‚ã ã‘è¨ˆç®—ã—ã€ãã‚Œä»¥å¤–ã¯ nullï¼ˆUI ã¯ "-" ã§è¡¨ç¤ºã™ã‚‹ï¼‰
      const serverProgress = (typeof sl === "number" && Number.isFinite(sl)) ? (sl % 3) : null;
      const localProgress  = (typeof ll === "number" && Number.isFinite(ll)) ? (ll % 3) : null;

      // â˜… è¿½åŠ ãƒ­ã‚°: progress ã®ç®—å‡ºãŒã€Œè¨ˆç®—ã§ããŸã‹/æ¬ æã‹ã€ã‚’ç¢ºèª
      console.log("[SYNC-A][UI] progress computed (no-fallback)", {
        qid: QID,
        serverProgress: serverProgress,
        localProgress: localProgress,
        missing: {
          server: (serverProgress === null),
          local: (localProgress === null)
        }
      });

      // â˜… ä¸æ­£è§£ã‚¹ãƒˆãƒªãƒ¼ã‚¯ï¼ˆSYNC å´ï¼‰ã®æœ€æ–°å€¤ã‚’ __cscs_sync_state ã‹ã‚‰å–å¾—ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç¦æ­¢ï¼‰
      let ssWrong = null;
      let slWrong = null;
      try{
        const state = (window.__cscs_sync_state && typeof window.__cscs_sync_state === "object")
          ? window.__cscs_sync_state
          : null;

        // â˜… å‡¦ç†1: stateæœªå–å¾—ãªã‚‰ null ã®ã¾ã¾ï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
        if (!state) {
          console.log("[SYNC-A][NO-FALLBACK] __cscs_sync_state missing -> wrong streak server = null", {
            qid: QID
          });
        } else {
          // â˜… å‡¦ç†2: streak3Wrong[qid] ã‚’å³å¯†ã«æ¤œè¨¼ã—ã¦æ¡ç”¨ï¼ˆæ¬ æ/å‹ä¸æ­£ã¯ nullï¼‰
          if (state.streak3Wrong && typeof state.streak3Wrong === "object" && Object.prototype.hasOwnProperty.call(state.streak3Wrong, QID)) {
            const v = state.streak3Wrong[QID];
            if (typeof v === "number" && Number.isFinite(v) && v >= 0) {
              ssWrong = v;
              console.log("[SYNC-A][NO-FALLBACK] wrong streak3 server ok", { qid: QID, value: ssWrong });
            } else {
              console.error("[SYNC-A][NO-FALLBACK] wrong streak3 server invalid -> null", { qid: QID, value: v, type: typeof v });
            }
          } else {
            console.log("[SYNC-A][NO-FALLBACK] wrong streak3 server missing entry -> null", { qid: QID });
          }

          // â˜… å‡¦ç†3: streakWrongLen[qid] ã‚’å³å¯†ã«æ¤œè¨¼ã—ã¦æ¡ç”¨ï¼ˆæ¬ æ/å‹ä¸æ­£ã¯ nullï¼‰
          if (state.streakWrongLen && typeof state.streakWrongLen === "object" && Object.prototype.hasOwnProperty.call(state.streakWrongLen, QID)) {
            const v2 = state.streakWrongLen[QID];
            if (typeof v2 === "number" && Number.isFinite(v2) && v2 >= 0) {
              slWrong = v2;
              console.log("[SYNC-A][NO-FALLBACK] wrong streakLen server ok", { qid: QID, value: slWrong });
            } else {
              console.error("[SYNC-A][NO-FALLBACK] wrong streakLen server invalid -> null", { qid: QID, value: v2, type: typeof v2 });
            }
          } else {
            console.log("[SYNC-A][NO-FALLBACK] wrong streakLen server missing entry -> null", { qid: QID });
          }
        }
      }catch(e){
        ssWrong = null;
        slWrong = null;
        console.error("[SYNC-A][NO-FALLBACK] wrong streak server read exception -> nulls", {
          qid: QID,
          error: String(e && e.message || e)
        });
      }

      // â˜… å‡¦ç†4: progress ã¯ â€œè¨ˆç®—ã§ãã‚‹æ™‚ã ã‘â€ è¨ˆç®—ï¼ˆnullãªã‚‰ "-" è¡¨ç¤ºã¸ï¼‰
      const serverWrongProgress = (typeof slWrong === "number" && Number.isFinite(slWrong)) ? (slWrong % 3) : null;
      const localWrongProgress  = (typeof llWrong === "number" && Number.isFinite(llWrong)) ? (llWrong % 3) : null;

      console.log("[SYNC-A][NO-FALLBACK] wrong progress computed", {
        qid: QID,
        serverWrongProgress: serverWrongProgress,
        localWrongProgress: localWrongProgress,
        missing: {
          server: (serverWrongProgress === null),
          local: (localWrongProgress === null)
        }
      });

      // â˜… åˆå›ã ã‘ã€ä¸æ­£è§£ã‚¹ãƒˆãƒªãƒ¼ã‚¯ UI ã®å€¤ã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ãƒ­ã‚°å‡ºã—
      if (!loggedWrongStreakUiOnce) {
        console.log("[SYNC-A] wrong-streak monitor enabled", {
          qid: QID,
          localWrongStreak3Total: lsWrong,
          localWrongStreakLen: llWrong,
          serverWrongStreak3Total: ssWrong,
          serverWrongStreakLen: slWrong
        });
        loggedWrongStreakUiOnce = true;
      }

      // â˜… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œå…¨æ’é™¤ï¼šSYNC state ãŒç„¡ã‘ã‚Œã° nullï¼ˆæ¬ ææ‰±ã„ï¼‰ã§ä¿æŒã™ã‚‹
      //   - { unique_count: 0 } ã®ã‚ˆã†ãª â€œå‹æ‰‹ãª0åŸ‹ã‚ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆâ€ ã‚’ç¦æ­¢ã™ã‚‹
      let streak3Today = null;
      try{
        const state = (window.__cscs_sync_state && typeof window.__cscs_sync_state === "object")
          ? window.__cscs_sync_state
          : null;

        if (state && state.streak3Today && typeof state.streak3Today === "object") {
          streak3Today = state.streak3Today;
          console.log("[SYNC-A][NO-FALLBACK][STATE] streak3Today ok (object)", {
            hasDay: Object.prototype.hasOwnProperty.call(streak3Today, "day"),
            hasUniqueCount: Object.prototype.hasOwnProperty.call(streak3Today, "unique_count"),
            hasQids: Object.prototype.hasOwnProperty.call(streak3Today, "qids")
          });
        } else {
          streak3Today = null;
          console.log("[SYNC-A][NO-FALLBACK][STATE] streak3Today missing -> null", {
            hasState: !!state
          });
        }
      }catch(e){
        streak3Today = null;
        console.error("[SYNC-A][NO-FALLBACK][STATE] streak3Today read exception -> null", {
          error: String(e && e.message || e)
        });
      }

      // â˜… UIè¡¨ç¤ºç”¨ï¼šSYNCå´ã¯ â€œå–ã‚ŒãŸæ™‚ã ã‘â€ å€¤ã‚’æ¡ç”¨ï¼ˆå–ã‚Œãªã‘ã‚Œã°ç©ºâ†’-ï¼‰
      const streak3TodayDayForUi =
        (streak3Today && Object.prototype.hasOwnProperty.call(streak3Today, "day"))
          ? streak3Today.day
          : "";

      const streak3TodayCountForUi =
        (streak3Today && typeof streak3Today.unique_count === "number" && Number.isFinite(streak3Today.unique_count))
          ? streak3Today.unique_count
          : "";

      let localStreakDay = "";
      let localStreakCount = null;
      try{
        // â˜… å‡¦ç†1: day ã¯ â€œç„¡ã„ãªã‚‰ç„¡ã„â€ ã‚’æ­£ã¨ã—ã¦ç©ºæ–‡å­—ï¼ˆUIå´ã§ "-" / -ã«è½ã¨ã™ï¼‰
        localStreakDay = localStorage.getItem("cscs_streak3_today_day") || "";

        // â˜… å‡¦ç†2: unique_count ã¯æ¬ æãªã‚‰ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
        const k = "cscs_streak3_today_unique_count";
        const rawLocalCnt = localStorage.getItem(k);

        if (rawLocalCnt === null || rawLocalCnt === undefined) {
          localStreakCount = null;
          console.log("[SYNC-A][NO-FALLBACK][LS] streak3Today unique_count missing -> null", {
            key: k
          });
        } else {
          const s = String(rawLocalCnt).trim();
          if (s === "") {
            localStreakCount = null;
            console.log("[SYNC-A][NO-FALLBACK][LS] streak3Today unique_count empty -> null", {
              key: k,
              raw: rawLocalCnt
            });
          } else if (!/^\d+$/.test(s)) {
            localStreakCount = null;
            console.error("[SYNC-A][NO-FALLBACK][LS] streak3Today unique_count invalid -> null", {
              key: k,
              raw: rawLocalCnt
            });
          } else {
            const n = parseInt(s, 10);
            localStreakCount = (Number.isFinite(n) && n >= 0) ? n : null;
            console.log("[SYNC-A][NO-FALLBACK][LS] streak3Today unique_count ok", {
              key: k,
              value: localStreakCount
            });
          }
        }
      }catch(e){
        localStreakCount = null;
        console.error("[SYNC-A][NO-FALLBACK][LS] streak3Today unique_count exception -> null", {
          error: String(e && e.message || e)
        });
      }

      // â˜… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Œå…¨æ’é™¤ï¼šSYNC state ãŒç„¡ã‘ã‚Œã° nullï¼ˆæ¬ ææ‰±ã„ï¼‰ã§ä¿æŒã™ã‚‹
      let streak3WrongToday = null;
      try{
        const state = (window.__cscs_sync_state && typeof window.__cscs_sync_state === "object")
          ? window.__cscs_sync_state
          : null;

        if (state && state.streak3WrongToday && typeof state.streak3WrongToday === "object") {
          streak3WrongToday = state.streak3WrongToday;
          console.log("[SYNC-A][NO-FALLBACK][STATE] streak3WrongToday ok (object)", {
            hasDay: Object.prototype.hasOwnProperty.call(streak3WrongToday, "day"),
            hasUniqueCount: Object.prototype.hasOwnProperty.call(streak3WrongToday, "unique_count"),
            hasQids: Object.prototype.hasOwnProperty.call(streak3WrongToday, "qids")
          });
        } else {
          streak3WrongToday = null;
          console.log("[SYNC-A][NO-FALLBACK][STATE] streak3WrongToday missing -> null", {
            hasState: !!state
          });
        }
      }catch(e){
        streak3WrongToday = null;
        console.error("[SYNC-A][NO-FALLBACK][STATE] streak3WrongToday read exception -> null", {
          error: String(e && e.message || e)
        });
      }

      // â˜… UIè¡¨ç¤ºç”¨ï¼šSYNCå´ã¯ â€œå–ã‚ŒãŸæ™‚ã ã‘â€ å€¤ã‚’æ¡ç”¨ï¼ˆå–ã‚Œãªã‘ã‚Œã°ç©ºâ†’-ï¼‰
      const streak3WrongTodayDayForUi =
        (streak3WrongToday && Object.prototype.hasOwnProperty.call(streak3WrongToday, "day"))
          ? streak3WrongToday.day
          : "";

      const streak3WrongTodayCountForUi =
        (streak3WrongToday && typeof streak3WrongToday.unique_count === "number" && Number.isFinite(streak3WrongToday.unique_count))
          ? streak3WrongToday.unique_count
          : "";

      let localWrongStreakDay = "";
      let localWrongStreakCount = null;
      try{
        // â˜… å‡¦ç†1: day ã¯ â€œç„¡ã„ãªã‚‰ç„¡ã„â€ ã‚’æ­£ã¨ã—ã¦ç©ºæ–‡å­—
        localWrongStreakDay = localStorage.getItem("cscs_streak3_wrong_today_day") || "";

        // â˜… å‡¦ç†2: unique_count ã¯æ¬ æãªã‚‰ nullï¼ˆ0åŸ‹ã‚ç¦æ­¢ï¼‰
        const k = "cscs_streak3_wrong_today_unique_count";
        const rawLocalWrongCnt = localStorage.getItem(k);

        if (rawLocalWrongCnt === null || rawLocalWrongCnt === undefined) {
          localWrongStreakCount = null;
          console.log("[SYNC-A][NO-FALLBACK][LS] streak3WrongToday unique_count missing -> null", {
            key: k
          });
        } else {
          const s = String(rawLocalWrongCnt).trim();
          if (s === "") {
            localWrongStreakCount = null;
            console.log("[SYNC-A][NO-FALLBACK][LS] streak3WrongToday unique_count empty -> null", {
              key: k,
              raw: rawLocalWrongCnt
            });
          } else if (!/^\d+$/.test(s)) {
            localWrongStreakCount = null;
            console.error("[SYNC-A][NO-FALLBACK][LS] streak3WrongToday unique_count invalid -> null", {
              key: k,
              raw: rawLocalWrongCnt
            });
          } else {
            const n = parseInt(s, 10);
            localWrongStreakCount = (Number.isFinite(n) && n >= 0) ? n : null;
            console.log("[SYNC-A][NO-FALLBACK][LS] streak3WrongToday unique_count ok", {
              key: k,
              value: localWrongStreakCount
            });
          }
        }
      }catch(e){
        localWrongStreakCount = null;
        console.error("[SYNC-A][NO-FALLBACK][LS] streak3WrongToday unique_count exception -> null", {
          error: String(e && e.message || e)
        });
      }

      // â˜… å•é¡Œåˆ¥ æœ€çµ‚æ—¥æƒ…å ±ï¼ˆLastSeen / LastCorrect / LastWrongï¼‰ã®å–å¾—
      //   - local: localStorage ã«ä¿å­˜ã•ã‚ŒãŸæœ€çµ‚æ—¥
      //   - sync : window.__cscs_sync_state.lastSeenDay ãªã©ã«ä¿å­˜ã•ã‚ŒãŸæœ€çµ‚æ—¥
      let lastSeenLocal = "";
      let lastCorrectLocal = "";
      let lastWrongLocal = "";
      try{
        lastSeenLocal = readLocalLastSeenDayForQid(QID);
        lastCorrectLocal = readLocalLastCorrectDayForQid(QID);
        lastWrongLocal = readLocalLastWrongDayForQid(QID);
      }catch(_){}

      let lastSeenSync = "";
      let lastCorrectSync = "";
      let lastWrongSync = "";
      try{
        const stateForLast = (window.__cscs_sync_state && typeof window.__cscs_sync_state === "object")
          ? window.__cscs_sync_state
          : null;

        if (stateForLast && stateForLast.lastSeenDay && typeof stateForLast.lastSeenDay === "object") {
          const v = stateForLast.lastSeenDay[QID];
          // â˜… æœ€çµ‚é–²è¦§æ—¥ã® SYNC å€¤ã¯ string / number ã®ã©ã¡ã‚‰ã§ã‚‚æ¥ã‚‹æƒ³å®š
          //   - "20251211" / 20251211 ã®ä¸¡æ–¹ã‚’è¨±å®¹ã—ã€è¡¨ç¤ºç”¨ã«ã¯æ–‡å­—åˆ—ã«çµ±ä¸€ã™ã‚‹
          if (typeof v === "string" && v) {
            lastSeenSync = v;
          } else if (typeof v === "number" && Number.isFinite(v) && v > 0) {
            lastSeenSync = String(v);
          }
        }

        if (stateForLast && stateForLast.lastCorrectDay && typeof stateForLast.lastCorrectDay === "object") {
          const v2 = stateForLast.lastCorrectDay[QID];
          // â˜… æœ€çµ‚æ­£è§£æ—¥ã® SYNC å€¤ã‚‚ string / number ä¸¡å¯¾å¿œã§æ–‡å­—åˆ—åŒ–ã—ã¦æ‰±ã†
          if (typeof v2 === "string" && v2) {
            lastCorrectSync = v2;
          } else if (typeof v2 === "number" && Number.isFinite(v2) && v2 > 0) {
            lastCorrectSync = String(v2);
          }
        }

        if (stateForLast && stateForLast.lastWrongDay && typeof stateForLast.lastWrongDay === "object") {
          const v3 = stateForLast.lastWrongDay[QID];
          // â˜… æœ€çµ‚ä¸æ­£è§£æ—¥ã® SYNC å€¤ã‚‚åŒæ§˜ã« string / number ä¸¡å¯¾å¿œ
          if (typeof v3 === "string" && v3) {
            lastWrongSync = v3;
          } else if (typeof v3 === "number" && Number.isFinite(v3) && v3 > 0) {
            lastWrongSync = String(v3);
          }
        }
      }catch(_){}


```
<<<PART_END>>>
ã€RECEIPT_INPUTï¼ˆã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã ã‘ã‚’çœŸã¨ã™ã‚‹ï¼‰ã€‘
EXPECTED_TOTAL: 5
RECEIVED_TOTAL: 1

CUMULATIVE_RECEIVED_PARTIDS:
- CSCSJS-1F73660D-P01-of-05

ã€ChatGPTã¸ã®å¼·åˆ¶ãƒ«ãƒ¼ãƒ«ã€‘
ãƒ»å—é ˜ç¢ºèªã¯ã€ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã® CUMULATIVE_RECEIVED_PARTIDS ã¨ EXPECTED_PARTIDS ã®ã¿ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚
ãƒ»ä¼šè©±å±¥æ­´ã‹ã‚‰ PartID ã‚’å†åé›†ã—ãªã„ã“ã¨ï¼ˆç¦æ­¢ï¼‰ã€‚
ãƒ»å—é ˜ç¢ºèªOKå‰ã«ã€ã‚³ãƒ¼ãƒ‰å†…å®¹ã®è§£é‡ˆãƒ»è¦ç´„ãƒ»æ¨æ¸¬ãƒ»ä¿®æ­£æ¡ˆæç¤ºã‚’ã—ãªã„ã“ã¨ï¼ˆç¦æ­¢ï¼‰ã€‚

RECEIPT_REQUIRED_RESPONSE_TEMPLATE:
ACK: <PartID> <PartSHA256_8> / WAITING_NEXT

ã€åˆ†å‰²ã‚³ãƒ¼ãƒ‰(1)ã®çµ‚äº†ã€‘â†’ æ¬¡ã¯ åˆ†å‰²ã‚³ãƒ¼ãƒ‰(2) ã‚’é€ã‚Šã¾ã™
ã€ChatGPTã¸ã®æŒ‡ç¤ºã€‘è§£é‡ˆãƒ»è¦ç´„ãƒ»æ¨æ¸¬ãƒ»ä¿®æ­£æ¡ˆæç¤ºã¯ç¦æ­¢ã€‚è¿”ç­”ã¯æ¬¡ã®ã¿ã€‚
ACK: <PartID> / WAITING_NEXT
