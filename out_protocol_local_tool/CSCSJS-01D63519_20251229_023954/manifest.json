{
  "session_id": "CSCSJS-01D63519",
  "created_at": "2025-12-29T02:39:54",
  "instruction": "Aパートの SYNC パネルに、以下の「初回セット導線（最小仕様）」を追加してください。\n\n【UI要素（Aパートのみ）】\n- ボタン：\n  - 表示名：「キー発行 / 再発行」\n- 表示情報：\n  - user：Cloudflare Access で認証された email\n  - key 状態：localStorage(\"cscs_sync_key\") が present / missing\n  - state 状態：/api/sync/state の結果（200 / 400 / 403）\n\n【ボタン押下時の処理（固定・推測禁止）】\n1) POST /api/sync/init を実行\n   - method: POST\n   - body: { force: false }（再発行時のみ true）\n   - credentials: include\n\n2) レスポンスが 200 の場合\n   - response.body.key を\n     localStorage.setItem(\"cscs_sync_key\", key) に保存する\n\n3) 保存直後に GET /api/sync/state を実行\n   - headers: { \"X-CSCS-Key\": localStorage(\"cscs_sync_key\") }\n   - credentials: include\n\n4) 判定ログを「1行」で必ず出す（毎回）\n   - 成功条件：\n       init = 200\n       state = 200\n     → 「✅ INIT+STATE OK」\n   - それ以外：\n     → 「❌ INIT+STATE FAILED（status を併記）」\n\n【設計ルール】\n- フォールバック禁止（推測で key / user / status を補わない）\n- A/B 共通JSには入れない（Aパート専用実装）\n- 既存の SYNC ロジック・計測ロジックには一切影響を与えない\n- 目的は「Accessユーザーと sync key の紐付けを一度で確定させる」ことのみ\n\nこの導線により、\n- 初回セット完了後は /api/sync/state が常に 200\n- B 側の POST /api/sync/merge が素通り\n- 以後のデバッグは “鍵不一致” ノイズ無しで進められる状態になる",
  "input": {
    "filename": "cscs_sync_a.js",
    "size_chars": 148361,
    "sha256": "01d63519d5ca53e2d0d6cecbe1dba233fd018deb9845e05484d0fad072e1e502",
    "saved_copy": "original/cscs_sync_a.js"
  },
  "split": {
    "total_parts": 4,
    "max_chars_per_part": 60000,
    "max_lines_per_part": 1200,
    "strategy": "split_on_newline_preferably_else_hard"
  },
  "parts": [
    {
      "index": 1,
      "total": 4,
      "part_id": "CSCSJS-01D63519-P01-of-04",
      "part_sha256": "2104e78ff64e3cad6efdbaa6816bc5886c72d5352f672d569daac3904becd4aa",
      "start_offset": 0,
      "end_offset": 43833,
      "len_chars": 43833,
      "file": "parts/part_01.txt"
    },
    {
      "index": 2,
      "total": 4,
      "part_id": "CSCSJS-01D63519-P02-of-04",
      "part_sha256": "b27132e67837293d5c12f5bb365cf1c01e2b00720e92b002f20cd1aa7eae4baf",
      "start_offset": 43833,
      "end_offset": 88398,
      "len_chars": 44565,
      "file": "parts/part_02.txt"
    },
    {
      "index": 3,
      "total": 4,
      "part_id": "CSCSJS-01D63519-P03-of-04",
      "part_sha256": "fbf7a72ffea36e5f74dd3c3ac951b47344967ffec2ba0376c176358eacf76258",
      "start_offset": 88398,
      "end_offset": 127280,
      "len_chars": 38882,
      "file": "parts/part_03.txt"
    },
    {
      "index": 4,
      "total": 4,
      "part_id": "CSCSJS-01D63519-P04-of-04",
      "part_sha256": "8cca952b47ea8c075063b42d022cfaa1ddae9c3661c166abffa8bbde3bdcaacf",
      "start_offset": 127280,
      "end_offset": 148361,
      "len_chars": 21081,
      "file": "parts/part_04.txt"
    }
  ]
}