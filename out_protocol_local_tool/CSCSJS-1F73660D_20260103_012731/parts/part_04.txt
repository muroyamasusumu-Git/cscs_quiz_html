<<<PART_BEGIN>>>
ã€åˆ†å‰²ã‚³ãƒ¼ãƒ‰(4)ã®é–‹å§‹ã€‘
PartID: CSCSJS-1F73660D-P04-of-05
PartSHA256: 3dbe7c466ab58f2e299b18fd6e85cc52a44f357192c97ed8e2f504c2214fb465
Range: chars 123559..160302 (len=36743)
FirstLine:       //   - state å´ã¯ string/number æ··åœ¨ãŒã‚ã‚Šå¾—ã‚‹ãŸã‚ã€ä¿å­˜ã¯å¸¸ã« String(v) ã«çµ±ä¸€ã™ã‚‹ã€‚
LastLine:         </div>
EndNewline: YES
PART_SCOPE_HINT: LineRange=L3277..L4441 | BraceDepth=3->3
PART_SCOPE_HINT_TOP_IDENTIFIERS: div:235, sync:201, span:121, cscs_sync_monitor_a:67, grid:57, font:46, local:42, mini:42, SYNC:40, localStorage:39, label:39, e:35
PART_SCOPE_HINT_DEFINES: readDatasetNonNegIntOrNull, resetSyncForThisQid, resetStarForThisQid, resetStreak3TodayAll, resetOncePerDayTodayAll, resetAllQidSyncAndLocal, kSeen, kCor, kWrg, vSeen, vCor, vWrg, rawSeen, rawCor, rawWrg, canDisplayQidNumbers, missing, kCorNow, kWrgNow, kCorLast, kWrgLast, kStreakLen, kStreakTotal, kStreakLastS3, logKey, raw, parsed, filtered, totalsEl, s, n, sc, si, stars, res, removedKeys, prefixes, key, globalKeys, had

```javascript
      //   - state å´ã¯ string/number æ··åœ¨ãŒã‚ã‚Šå¾—ã‚‹ãŸã‚ã€ä¿å­˜ã¯å¸¸ã« String(v) ã«çµ±ä¸€ã™ã‚‹ã€‚
      //   - å€¤ãŒç„¡ã„/ç©ºï¼ˆnull/undefined/""/ç©ºç™½ã®ã¿ï¼‰ã®å ´åˆã¯ removeItem ã—ã¦ã€Œãªã„ã€ã‚’æ­£ã¨ã—ã¦åæ˜ ã™ã‚‹ã€‚
      try{
        const kSeen = "cscs_q_last_seen_day:" + QID;
        const kCor  = "cscs_q_last_correct_day:" + QID;
        const kWrg  = "cscs_q_last_wrong_day:" + QID;

        let vSeen = "";
        let vCor  = "";
        let vWrg  = "";

        if (s && s.lastSeenDay && typeof s.lastSeenDay === "object") {
          const rawSeen = s.lastSeenDay[QID];
          if (rawSeen !== null && rawSeen !== undefined) {
            vSeen = String(rawSeen);
          }
        }
        if (s && s.lastCorrectDay && typeof s.lastCorrectDay === "object") {
          const rawCor = s.lastCorrectDay[QID];
          if (rawCor !== null && rawCor !== undefined) {
            vCor = String(rawCor);
          }
        }
        if (s && s.lastWrongDay && typeof s.lastWrongDay === "object") {
          const rawWrg = s.lastWrongDay[QID];
          if (rawWrg !== null && rawWrg !== undefined) {
            vWrg = String(rawWrg);
          }
        }

        if (vSeen.trim() !== "") {
          localStorage.setItem(kSeen, vSeen);
        } else {
          localStorage.removeItem(kSeen);
        }

        if (vCor.trim() !== "") {
          localStorage.setItem(kCor, vCor);
        } else {
          localStorage.removeItem(kCor);
        }

        if (vWrg.trim() !== "") {
          localStorage.setItem(kWrg, vWrg);
        } else {
          localStorage.removeItem(kWrg);
        }

        console.log("[SYNC-A] initialFetch synced last-day fields from server to localStorage", {
          qid: QID,
          lastSeenDay: vSeen.trim() !== "" ? vSeen : null,
          lastCorrectDay: vCor.trim() !== "" ? vCor : null,
          lastWrongDay: vWrg.trim() !== "" ? vWrg : null
        });
      }catch(_){}

      // ============================================================
      // â˜… ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç„¡ã—ï¼šQIDæ•°å€¤ãŒå…¨éƒ¨å–ã‚ŒãŸå ´åˆã®ã¿ã€dataset ã¨ localStorage ã‚’åŒæœŸã™ã‚‹
      // ------------------------------------------------------------
      // - æ¬ æ/å‹ä¸æ­£ãŒã‚ã‚Œã°ãƒ­ã‚°ã‚’å‡ºã—ã¦ã€Œä¸Šæ›¸ãã—ãªã„ã€
      // - ãŸã ã—ã€Œè¡¨ç¤ºã€ã¯ã€å–ã‚ŒãŸsyncå€¤ã ã‘å‡ºã™ï¼ˆæ¬ æã¯æ¬ æã®ã¾ã¾ï¼‰
      // ============================================================

      // â˜… è¡¨ç¤ºç”¨ï¼ˆserverè¡¨ç¤ºï¼‰ï¼špartial OK ã§ã‚‚ã€å–ã‚ŒãŸå€¤ã ã‘è¡¨ç¤ºã™ã‚‹ï¼ˆæ¬ æã¯ null ã®ã¾ã¾ï¼‰
      const canDisplayQidNumbers = !!(rc.ok || ri.ok || rs3.ok || rsl.ok);
      if (canDisplayQidNumbers) {
        setServerTotalsForQid(
          rc.ok  ? rc.value  : null,
          ri.ok  ? ri.value  : null,
          rs3.ok ? rs3.value : null,
          rsl.ok ? rsl.value : null
        );
      }

      // â˜… ä¸Šæ›¸ãç”¨ï¼ˆlocalStorageåŒæœŸï¼‰ï¼šå¾“æ¥é€šã‚Šã€å…¨mapãŒæƒã£ãŸå ´åˆã®ã¿å®Ÿè¡Œ
      if (canSyncQidNumbers) {
        try{
          localStorage.setItem("cscs_q_correct_total:" + QID, String(rc.value));
          localStorage.setItem("cscs_q_wrong_total:"   + QID, String(ri.value));
          localStorage.setItem("cscs_q_correct_streak3_total:" + QID, String(rs3.value));
          localStorage.setItem("cscs_q_correct_streak_len:" + QID, String(rsl.value));
          localStorage.setItem("cscs_q_wrong_streak3_total:" + QID, String(rs3w.value));
          localStorage.setItem("cscs_q_wrong_streak_len:" + QID, String(rslw.value));

          console.log("[SYNC-A][OK] initialFetch synced qid numbers from server to localStorage", {
            qid: QID,
            correctTotal: rc.value,
            wrongTotal: ri.value,
            streak3Correct: rs3.value,
            streakLenCorrect: rsl.value,
            streak3Wrong: rs3w.value,
            streakLenWrong: rslw.value
          });
        }catch(eSync){
          console.error("[SYNC-A][ERROR] initialFetch localStorage sync failed", {
            qid: QID,
            error: String(eSync && eSync.message || eSync)
          });
        }
      } else {
        const missing = [];
        if (!rc.ok)   missing.push("correct");
        if (!ri.ok)   missing.push("incorrect");
        if (!rs3.ok)  missing.push("streak3");
        if (!rsl.ok)  missing.push("streakLen");
        if (!rs3w.ok) missing.push("streak3Wrong");
        if (!rslw.ok) missing.push("streakWrongLen");

        console.log("[SYNC-A][INCOMPLETE][NO-OVERWRITE] qid map incomplete: will NOT overwrite localStorage, UI shows sync-only (partial OK)", {
          qid: QID,
          missing: missing,
          ok: {
            correct: rc.ok,
            incorrect: ri.ok,
            streak3: rs3.ok,
            streakLen: rsl.ok,
            streak3Wrong: rs3w.ok,
            streakWrongLen: rslw.ok
          },
          display: {
            canDisplay: canDisplayQidNumbers,
            correctTotal: rc.ok ? rc.value : null,
            wrongTotal: ri.ok ? ri.value : null,
            streak3Correct: rs3.ok ? rs3.value : null,
            streakLenCorrect: rsl.ok ? rsl.value : null
          }
        });
      }

      lastSyncStatus = "pulled";
      lastSyncTime   = new Date().toLocaleTimeString();
      lastSyncError  = "";
    }catch(e){
      lastSyncStatus = "error";
      lastSyncError  = String(e && e.message || e);
    }finally{
      updateMonitor();
    }
  }

  async function resetSyncForThisQid(showAlert, doFetch){
    if (showAlert === undefined) showAlert = true;
    if (doFetch === undefined) doFetch = true;
    if (!QID) return;
    try{
      await fetch("/api/sync/reset_qid", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify({ qid: QID })
      });

      try{
        const kCorNow  = "cscs_q_correct_total:" + QID;
        const kWrgNow  = "cscs_q_wrong_total:"   + QID;
        const kCorLast = "cscs_sync_last_c:"     + QID;
        const kWrgLast = "cscs_sync_last_w:"     + QID;

        localStorage.setItem(kCorNow,  "0");
        localStorage.setItem(kWrgNow,  "0");
        localStorage.setItem(kCorLast, "0");
        localStorage.setItem(kWrgLast, "0");
      }catch(_){}

      if (doFetch) {
        await initialFetch();
      }
      if (showAlert) {
        alert("ã“ã®å•é¡Œã®SYNCã‚«ã‚¦ãƒ³ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚");
      }
    }catch(e){
      if (showAlert) {
        alert("reset å¤±æ•—: " + e);
      } else {
        console.warn("reset_qid å¤±æ•—:", e);
      }
    }
  }

  async function resetStarForThisQid(showAlert){
    if (showAlert === undefined) showAlert = true;
    if (!QID) return;
    try{
      try{
        await fetch("/api/sync/reset_streak3_qid", {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ qid: QID })
        });
      }catch(_){}

      const kStreakLen    = "cscs_q_correct_streak_len:" + QID;
      const kStreakTotal  = "cscs_q_correct_streak3_total:" + QID;
      const kStreakLastS3 = "cscs_sync_last_s3:" + QID;
      try{
        localStorage.removeItem(kStreakLen);
        localStorage.removeItem(kStreakTotal);
        localStorage.setItem(kStreakLastS3, "0");
      }catch(_){}

      const logKey = "cscs_correct_streak3_log";
      try{
        const raw = localStorage.getItem(logKey);
        if (raw) {
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) {
            const filtered = parsed.filter(function(entry){
              if (!entry || typeof entry !== "object") return true;
              if (!("qid" in entry)) return true;
              return entry.qid !== QID;
            });
            localStorage.setItem(logKey, JSON.stringify(filtered));
          }
        }
      }catch(_){}

      try{
        const totalsEl = document.getElementById("cscs_sync_totals");
        if (totalsEl) {
          // â˜… å‡¦ç†1: dataset ã‚’å³å¯†ã«èª­ã‚€ï¼ˆæ¬ æ/éæ•°ã¯ nullã€‚0åŸ‹ã‚ã—ãªã„ï¼‰
          function readDatasetNonNegIntOrNull(ds, keyName){
            try{
              if (!ds) return null;
              const raw = ds[keyName];
              if (raw === null || raw === undefined) return null;
              const s = String(raw).trim();
              if (s === "") return null;
              if (!/^\d+$/.test(s)) return null;
              const n = parseInt(s, 10);
              if (!Number.isFinite(n) || n < 0) return null;
              return n;
            }catch(_e){
              return null;
            }
          }

          const sc = readDatasetNonNegIntOrNull(totalsEl.dataset, "serverC");
          const si = readDatasetNonNegIntOrNull(totalsEl.dataset, "serverI");

          // â˜… å‡¦ç†2: ä¸¡æ–¹å–ã‚ŒãŸæ™‚ã ã‘ä¸Šæ›¸ãï¼ˆæ¬ æãªã‚‰ä¸Šæ›¸ãç¦æ­¢ï¼‰
          if (sc !== null && si !== null) {
            setServerTotalsForQid(sc, si, 0);
            console.log("[SYNC-A][OK][NO-FALLBACK] resetStar dataset updated", { serverC: sc, serverI: si });
          } else {
            console.error("[SYNC-A][NO-OVERWRITE] resetStar skipped dataset update (missing/invalid)", {
              serverC: sc,
              serverI: si
            });
          }
        }
      }catch(e){
        console.error("[SYNC-A][ERROR] resetStar dataset sync failed", {
          error: String(e && e.message || e)
        });
      }

      try{
        const stars = document.querySelectorAll(".correct_star");
        stars.forEach(function(el){
          el.style.display = "none";
        });
      }catch(_){}

      updateMonitor();

      if (showAlert) {
        alert("ã“ã®å•é¡Œã®æ˜Ÿãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚");
      }
    }catch(e){
      if (showAlert) {
        alert("æ˜Ÿãƒ‡ãƒ¼ã‚¿ã®ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: " + e);
      } else {
        console.warn("reset_streak3_qid å¤±æ•—:", e);
      }
    }
  }

  async function resetStreak3TodayAll(showAlert){
    if (showAlert === undefined) showAlert = true;
    try{
      await fetch("/api/sync/reset_streak3_today", {
        method:"POST",
        headers:{ "Content-Type":"application/json" }
      });

      // 1) localStorage å´ã®ä»Šæ—¥ã® 3é€£ç¶šæ­£è§£ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•°ã‚’å‰Šé™¤
      try{
        localStorage.removeItem("cscs_streak3_today_day");
        localStorage.removeItem("cscs_streak3_today_unique_count");
        localStorage.removeItem("cscs_streak3_today_qids");
      }catch(_){}

      // 2) ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ snapshot ã¯ã€Œç”Ÿæˆã—ã¦åŸ‹ã‚ã‚‹ã€ã®ç¦æ­¢ï¼šå­˜åœ¨ã—ã¦ã‚‚å‰Šé™¤/æœªå®šç¾©ã«ã™ã‚‹ï¼ˆno-fallbackï¼‰
      try{
        if (window.__cscs_sync_state && typeof window.__cscs_sync_state === "object") {
          delete window.__cscs_sync_state.streak3Today;
        }
        console.log("[SYNC-A][NO-FALLBACK][RESET] cleared snapshot streak3Today (delete only)", {
          hasState: !!window.__cscs_sync_state
        });
      }catch(e){
        console.error("[SYNC-A][NO-FALLBACK][RESET] clear snapshot streak3Today failed", {
          error: String(e && e.message || e)
        });
      }

      // 3) ã‚µãƒ¼ãƒãƒ¼å´ã®æœ€æ–°çŠ¶æ…‹ã‚’ /api/sync/state ã‹ã‚‰å–ã‚Šç›´ã—ã¦ä¸Šæ›¸ãï¼ˆstreak3Today ã‚‚å«ã‚ã¦ç¢ºèªï¼‰
      try{
        const s = await CSCS_SYNC.fetchServer();
        window.__cscs_sync_state = s;
      }catch(_){}

      // 4) ãƒ¢ãƒ‹ã‚¿è¡¨ç¤ºã‚’æœ€æ–°çŠ¶æ…‹ã§å†æç”»
      updateMonitor();

      if (showAlert) {
        alert("ä»Šæ—¥ã® 3é€£ç¶šæ­£è§£ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•°ï¼ˆSYNC ã¨ local ã®ä¸¡æ–¹ï¼‰ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚");
      }
    }catch(e){
      if (showAlert) {
        alert("reset_streak3_today å¤±æ•—: " + e);
      } else {
        console.warn("reset_streak3_today å¤±æ•—:", e);
      }
    }
  }

  // oncePerDayTodayï¼ˆ1æ—¥1å•ã‚«ã‚¦ãƒ³ãƒˆï¼‰ç”¨ã® SYNC + local ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒãƒƒã‚°å°‚ç”¨ï¼‰
  async function resetOncePerDayTodayAll(showAlert){
    if (showAlert === undefined) showAlert = true;
    try{
      console.log("[SYNC-A:oncePerDay] reset_once_per_day_today START");

      // 1) Workers å´ã® oncePerDayToday ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæƒ³å®šï¼‰
      const res = await fetch("/api/sync/reset_once_per_day_today", {
        method: "POST",
        headers: { "Content-Type": "application/json" }
      });
      if (!res.ok) {
        throw new Error(String(res.status));
      }

      // 2) localStorage å´ã® oncePerDayToday æƒ…å ±ã‚’å‰Šé™¤
      try{
        localStorage.removeItem("cscs_once_per_day_today_day");
        localStorage.removeItem("cscs_once_per_day_today_results");
      }catch(_){}

      // 3) ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ snapshot ã¯ã€Œç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã€ç¦æ­¢ï¼šå­˜åœ¨ã—ã¦ã‚‚å‰Šé™¤/æœªå®šç¾©ã«ã™ã‚‹ï¼ˆno-fallbackï¼‰
      try{
        if (window.__cscs_sync_state && typeof window.__cscs_sync_state === "object") {
          delete window.__cscs_sync_state.oncePerDayToday;
        }
        console.log("[SYNC-A][NO-FALLBACK][RESET] cleared snapshot oncePerDayToday (delete only)", {
          hasState: !!window.__cscs_sync_state
        });
      }catch(e){
        console.error("[SYNC-A][NO-FALLBACK][RESET] clear snapshot oncePerDayToday failed", {
          error: String(e && e.message || e)
        });
      }

      // 4) ã‚µãƒ¼ãƒãƒ¼å´ã®æœ€æ–°çŠ¶æ…‹ã‚’å–ã‚Šç›´ã—ã¦ã€oncePerDayToday ã‚‚å«ã‚ã¦ä¸Šæ›¸ã
      try{
        const s = await CSCS_SYNC.fetchServer();
        window.__cscs_sync_state = s;
      }catch(_){}

      // 5) ãƒ¢ãƒ‹ã‚¿ã‚’æœ€æ–°çŠ¶æ…‹ã§å†æç”»
      updateMonitor();

      console.log("[SYNC-A:oncePerDay] reset_once_per_day_today completed (SYNC + local cleared)");
      if (showAlert) {
        alert("oncePerDayTodayï¼ˆSYNC ã¨ local ã®ä¸¡æ–¹ï¼‰ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚");
      }
    }catch(e){
      console.warn("[SYNC-A:oncePerDay] reset_once_per_day_today failed:", e);
      if (showAlert) {
        alert("reset_once_per_day_today å¤±æ•—: " + e);
      }
    }
  }

  // â˜… ãƒ‡ãƒãƒƒã‚°å°‚ç”¨: å…¨ã¦ã® qid ã®è¨ˆæ¸¬ç³» SYNC + local è¨˜éŒ²ã‚’ä¸€æ‹¬ãƒªã‚»ãƒƒãƒˆã™ã‚‹
  //   - æœ¬ä»•æ§˜ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ©Ÿèƒ½ã§ã¯ãªãã€é–‹ç™ºãƒ»æ¤œè¨¼ç”¨ã®ã¿ã«ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚’æƒ³å®š
  async function resetAllQidSyncAndLocal(showAlert){
    if (showAlert === undefined) showAlert = true;
    try{
      console.log("[SYNC-A:debug] reset_all_qid START");

      // 1) Workers å´ã§å…¨qidã®è¨ˆæ¸¬ç³»ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆæƒ³å®šï¼‰
      const res = await fetch("/api/sync/reset_all_qid", {
        method: "POST",
        headers: { "Content-Type": "application/json" }
      });
      if (!res.ok) {
        throw new Error(String(res.status));
      }

      // 2) localStorage å´ã®è¨ˆæ¸¬ç³»ã‚­ãƒ¼ã‚’å…¨ã¦å‰Šé™¤
      let removedKeys = 0;
      try{
        const prefixes = [
          "cscs_q_correct_total:",
          "cscs_q_wrong_total:",
          "cscs_q_correct_streak3_total:",
          "cscs_q_correct_streak_len:",
          "cscs_q_wrong_streak3_total:",
          "cscs_q_wrong_streak_len:",
          "cscs_sync_last_c:",
          "cscs_sync_last_w:",
          "cscs_sync_last_s3:"
        ];

        for (let i = localStorage.length - 1; i >= 0; i--) {
          const key = localStorage.key(i);
          if (!key) continue;
          for (let j = 0; j < prefixes.length; j++) {
            if (key.indexOf(prefixes[j]) === 0) {
              localStorage.removeItem(key);
              removedKeys++;
              break;
            }
          }
        }

        const globalKeys = [
          "cscs_streak3_today_day",
          "cscs_streak3_today_unique_count",
          "cscs_streak3_today_qids",
          // â˜… ä»Šæ—¥ã®3é€£ç¶šä¸æ­£è§£ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•°ï¼ˆStreak3WrongTodayï¼‰é–¢é€£ã‚­ãƒ¼ã‚‚ä¸€æ‹¬å‰Šé™¤å¯¾è±¡ã«å«ã‚ã‚‹
          //   - reset_all_qid å®Ÿè¡Œæ™‚ã«ã€Œä»Šæ—¥ã®3é€£ç¶šä¸æ­£è§£ãƒ¦ãƒ‹ãƒ¼ã‚¯æ•°ã€ã®ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚‚å®Œå…¨ãƒªã‚»ãƒƒãƒˆã™ã‚‹ã€‚
          "cscs_streak3_wrong_today_day",
          "cscs_streak3_wrong_today_unique_count",
          "cscs_streak3_wrong_today_qids",
          "cscs_once_per_day_today_day",
          "cscs_once_per_day_today_results",
          "cscs_correct_streak3_log"
        ];
        for (let g = 0; g < globalKeys.length; g++) {
          try{
            if (localStorage.getItem(globalKeys[g]) !== null) {
              localStorage.removeItem(globalKeys[g]);
              removedKeys++;
            }
          }catch(_){}
        }
      }catch(_){}

      // 3) ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ snapshot ã‚’ä¸€æ—¦ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰ /api/sync/state ã‚’å–ã‚Šç›´ã™ï¼ˆno-fallbackï¼‰
      //   - ç©ºã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆã§ã€Œå­˜åœ¨ã™ã‚‹ä½“ã€ã‚’ä½œã‚‰ãªã„
      //   - delete + null ã«ã—ã¦ã€Œç„¡ã„ã€ã‚’æ­£ã¨ã—ã¦æ‰±ã†
      try{
        const had = Object.prototype.hasOwnProperty.call(window, "__cscs_sync_state");
        if (had) {
          delete window.__cscs_sync_state;
        }
        window.__cscs_sync_state = null;

        console.log("[SYNC-A][NO-FALLBACK][RESET] cleared snapshot __cscs_sync_state (delete + null)", {
          had: had,
          nowType: typeof window.__cscs_sync_state,
          nowValue: window.__cscs_sync_state
        });
      }catch(e){
        console.error("[SYNC-A][NO-FALLBACK][RESET] clear snapshot __cscs_sync_state failed", {
          error: String(e && e.message || e)
        });
      }

      try{
        const s = await CSCS_SYNC.fetchServer();
        window.__cscs_sync_state = s;
      }catch(_){}

      // 4) ãƒ¢ãƒ‹ã‚¿ã‚’æœ€æ–°çŠ¶æ…‹ã§å†æç”»
      updateMonitor();

      console.log("[SYNC-A:debug] reset_all_qid COMPLETED", {
        removedLocalKeys: removedKeys
      });

      if (showAlert) {
        alert("å…¨ã¦ã®å•é¡Œ(qid)ã®è¨ˆæ¸¬ç³» SYNC ã¨ local è¨˜éŒ²ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸï¼ˆãƒ‡ãƒãƒƒã‚°å°‚ç”¨ï¼‰ã€‚");
      }
    }catch(e){
      console.warn("[SYNC-A:debug] reset_all_qid FAILED:", e);
      if (showAlert) {
        alert("reset_all_qid å¤±æ•—: " + e);
      }
    }
  }

  window.addEventListener("DOMContentLoaded", function(){
    if (!QID) return;
    try{
      // SYNC(A) monitor ã®è¦‹ãŸç›®ï¼ˆã‚°ãƒªãƒƒãƒ‰/ã‚«ãƒ¼ãƒ‰ï¼‰ç”¨CSSã‚’ä¸€åº¦ã ã‘æ³¨å…¥
      try{
        if (!document.getElementById("cscs-sync-a-monitor-style")) {
          const st = document.createElement("style");
          st.id = "cscs-sync-a-monitor-style";
          st.textContent = `
#cscs_sync_monitor_a{
  margin-top: 8px;
  font-size: 12px;
  line-height: 1.35;
}
#cscs_sync_monitor_a .sync-header{
  font-weight: 400;
  margin: 0 3px 6px 0;
  text-align: right;
  display: flex;
  align-items: center;
  justify-content: flex-end;
  gap: 8px;
}

#cscs_sync_monitor_a .sync-toggle-btn{
  appearance: none;
  border: 1px solid rgba(255,255,255,0.18);
  background: rgba(0,0,0,0.45);
  color: #eee;
  border-radius: 999px;
  padding: 3px 8px;
  font-size: 10.5px;
  line-height: 1;
  cursor: pointer;
  opacity: 0.9;
}
#cscs_sync_monitor_a .sync-toggle-btn:active{
  transform: translateY(1px);
}

/* â˜… OPEN/CLOSE ã§ã€Œã‚ªãƒ—ã‚·ãƒ§ãƒ³é …ç›®ï¼ˆæŒ‡å®š4ã¤ï¼‰ã€ã ã‘ã‚’éš ã™
   - ãƒ‘ãƒãƒ«è‡ªä½“ï¼ˆãƒ˜ãƒƒãƒ€/ä»–ã‚«ãƒ¼ãƒ‰ï¼‰ã¯å¸¸æ™‚è¡¨ç¤º
   - .sync-optional ã‚’ä»˜ã‘ãŸã‚«ãƒ¼ãƒ‰ã ã‘éè¡¨ç¤ºã«ã™ã‚‹ */
#cscs_sync_monitor_a.cscs-compact .sync-optional{
  display: none !important;
}

#cscs_sync_monitor_a .sync-grid{
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 2px;
  width: auto;
}

#cscs_sync_monitor_a {
  position: fixed;
  right: 15px;
  top: 100px;
  color: #eee;
  padding: 8px;
  font: 10px/1.2 system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
  max-width: 46vw;
  width: 310px;
  opacity: 0.55;
  z-index: 2147483647;
}

#cscs_sync_monitor_a details.sync-fold{
  margin: 0;
}
#cscs_sync_monitor_a details.sync-fold > summary{
  list-style: none;
  cursor: pointer;
  user-select: none;
  font-weight: 700;
  font-size: 11px;
  opacity: 0.85;
  margin-bottom: 4px;
}
#cscs_sync_monitor_a details.sync-fold > summary::-webkit-details-marker{
  display: none;
}
#cscs_sync_monitor_a details.sync-fold > summary::before{
  content: "â–¶";
  display: inline-block;
  width: 14px;
  opacity: 0.85;
}
#cscs_sync_monitor_a details.sync-fold[open] > summary::before{
  content: "â–¼";
}

@media (max-width: 520px){
  #cscs_sync_monitor_a .sync-grid{
    grid-template-columns: 1fr;
  }
}
#cscs_sync_monitor_a .sync-card{
  border-radius: 10px;
  padding: 8px 10px;

  /* ã‚¬ãƒ©ã‚¹æ„Ÿï¼šå°‘ã—é€ã‘ãŸé»’ */
  background: rgba(0,0,0,0.52);


  /* ã‚¨ãƒƒã‚¸ã®å…‰ï¼šè–„ã„ç™½æ  + ã»ã‚“ã®å°‘ã—å†…å´ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
  border: 1px solid rgba(255,255,255,0.14);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.06);

  line-height: 1;
}

/* â˜… initã‚«ãƒ¼ãƒ‰ï¼ˆuser/key/stateï¼‰ã®ãƒ†ã‚­ã‚¹ãƒˆã ã‘è–„ãã™ã‚‹ï¼ˆãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆï¼‰ */
#cscs_sync_monitor_a .sync-card.sync-init-card .sync-init-row{
  opacity: 0.58;
}

#cscs_sync_monitor_a .sync-card .sync-title{
  font-weight: 700;
  font-size: 11px;
  opacity: 0.85;
  margin-bottom: 5px;

  /* â˜… è¦‹å‡ºã—ã¯åŸºæœ¬çš„ã«æ”¹è¡Œã—ãªã„ï¼ˆå…¥ã‚Šåˆ‡ã‚‰ãªã„æ™‚ã¯â€¦ï¼‰ */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* â˜… è‹±èªãƒ©ãƒ™ãƒ«ã ã‘å°‘ã—è–„ããƒ»è»½ã */
#cscs_sync_monitor_a .sync-card .sync-title .sync-title-en{
  opacity: 0.58;
  font-weight: 600;
  letter-spacing: 0.02em;
}
#cscs_sync_monitor_a .sync-card .sync-body{
  /* â˜… ã‚°ãƒªãƒƒãƒ‰ã®ãƒã‚¹å†…ã§ã¯æ”¹è¡Œã•ã›ãªã„ï¼ˆå¿…è¦ãªã‚‰è¡Œã‚’ã‚°ãƒªãƒƒãƒ‰ã§åˆ†ã‘ã‚‹ï¼‰ */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  min-width: 0;

  /* â˜… è©³ç´°ï¼ˆæœ¬æ–‡ï¼‰ã¯è¦‹å‡ºã—ã‚ˆã‚Šå°‘ã—å¼±ã‚ã«ã—ã¦ã€éšå±¤ã‚’ã¯ã£ãã‚Šã•ã›ã‚‹ */
  word-break: normal;
  font-weight: 400;
  opacity: 0.52;
  font-size: 10.25px;
  letter-spacing: 0.01em;
}

/* â˜… â€œè¤‡æ•°è¡Œâ€ ã«è¦‹ã›ãŸã„ã‚‚ã®ã¯ <br> ã§ã¯ãªãã€Œå°ã‚°ãƒªãƒƒãƒ‰ã€ã§è¡Œã‚’åˆ†ã‘ã‚‹ */
#cscs_sync_monitor_a .mini-grid{
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 0px 10px;
  font-size: 11px;
  line-height: 1.25;
}

#cscs_sync_monitor_a .mini-label{
  font-weight: 600;
  opacity: 0.80;
  white-space: nowrap;
}

#cscs_sync_monitor_a .mini-val{
  font-weight: 500;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
}

#cscs_sync_monitor_a .status-grid{
  display: grid;
  grid-template-columns: auto 1fr;
  align-items: baseline;
  gap: 8px;
  font-size: 11px;
  line-height: 1.25;
}

#cscs_sync_monitor_a .status-label{
  font-weight: 600;
  font-size: 10.5px;
  letter-spacing: 0.02em;
  opacity: 0.80;
  white-space: nowrap;
}

#cscs_sync_monitor_a .status-value{
  font-weight: 500;
  font-size: 11px;
  letter-spacing: 0.01em;
  white-space: nowrap;
  font-variant-numeric: tabular-nums;
}

#cscs_sync_monitor_a .totals-row{
  display: grid;
  grid-template-columns: auto 1fr 1fr 1fr;
  gap: 6px 10px;
  align-items: center;
  font-size: 11px;
}

#cscs_sync_monitor_a .sync-totals-label{
  font-weight: 850;
  font-size: 11.5px;
  letter-spacing: 0.03em;
  opacity: 0.96;
  white-space: nowrap;
}

#cscs_sync_monitor_a .sync-totals,
#cscs_sync_monitor_a .sync-local,
#cscs_sync_monitor_a .sync-queue{
  white-space: nowrap;
}
#cscs_sync_monitor_a .sync-card.sync-span-2{
  grid-column: 1 / -1;
}

#cscs_sync_monitor_a .lastday-grid{
  display: grid;
  grid-template-columns: 80px 1fr 1fr;
  gap: 4px 10px;
  align-items: center;
  font-size: 11px;
}

#cscs_sync_monitor_a .lastday-grid .ld-head{
  font-weight: 700;
  opacity: 0.8;
}

#cscs_sync_monitor_a .lastday-grid .ld-label{
  opacity: 0.75;
}

#cscs_sync_monitor_a .days-grid{
  display: grid;
  grid-template-columns: 150px 1fr 1fr 60px;
  gap: 4px 10px;
  align-items: center;
  font-size: 11px;
}

#cscs_sync_monitor_a .days-head{
  font-weight: 700;
  opacity: 0.8;
  white-space: nowrap;
}

#cscs_sync_monitor_a .days-label{
  opacity: 0.78;
  white-space: nowrap;
}

#cscs_sync_monitor_a .days-val{
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
}

#cscs_sync_monitor_a .delta-grid{
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 4px 10px;
  align-items: center;
  font-size: 11px;
}

#cscs_sync_monitor_a .delta-label{
  opacity: 0.78;
  white-space: nowrap;
}

#cscs_sync_monitor_a .delta-val{
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
}

#cscs_sync_monitor_a .once-grid{
  display: grid;
  grid-template-columns: auto 1fr;
  gap: 4px 10px;
  font-size: 11px;
  line-height: 1.25;
}

#cscs_sync_monitor_a .once-label{
  font-weight: 600;
  opacity: 0.80;
  white-space: nowrap;
}

#cscs_sync_monitor_a .once-val{
  font-weight: 500;
  font-variant-numeric: tabular-nums;
  white-space: nowrap;
}

/* ============================================================
   â˜… OncePerDayToday / O.D.O.A Mode æŠ˜ã‚ŠãŸãŸã¿ï¼ˆã‚«ãƒ¼ãƒ‰å˜ä½“ï¼‰
   ------------------------------------------------------------
   - è¦‹å‡ºã—å³ç«¯ã«ã€Œâ–¶show / â–¼hideã€ãƒ†ã‚­ã‚¹ãƒˆãƒœã‚¿ãƒ³
   - æŠ˜ã‚ŠãŸãŸã¿æ™‚ã¯ã€Œè¦‹å‡ºã— + 3è¡Œç›®ï¼ˆcountå¯¾è±¡ï¼‰ã€ã ã‘è¡¨ç¤º
   ============================================================ */
#cscs_sync_monitor_a .sync-card.once-card .sync-title{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

#cscs_sync_monitor_a .once-fold-btn{
  appearance: none;
  border: none;
  background: transparent;
  color: rgba(255,255,255,0.86);
  font-weight: 700;
  font-size: 10.5px;
  line-height: 1;
  padding: 0;
  cursor: pointer;
  opacity: 0.92;
  white-space: nowrap;
}

#cscs_sync_monitor_a .once-fold-btn:active{
  transform: translateY(1px);
}

#cscs_sync_monitor_a .sync-nopull-btn {
    font-size: 9px;
    font-weight: 800;
    opacity: 0.7;
    text-shadow: none !impotant;
}
/* æŠ˜ã‚ŠãŸãŸã¿æ™‚ï¼šonce-grid ã®ã†ã¡ã€Œ3è¡Œç›®ï¼ˆcountå¯¾è±¡ï¼‰ã€ã ã‘æ®‹ã™
   once-grid ã®å­è¦ç´ ã¯ 8å€‹ï¼ˆlabel/val Ã—4è¡Œï¼‰
   3è¡Œç›®ã¯ 5ç•ªç›®(label) ã¨ 6ç•ªç›®(val) */
#cscs_sync_monitor_a .sync-card.once-card.once-collapsed .once-grid > :not(:nth-child(5)):not(:nth-child(6)){
  display: none !important;
}

/* ============================================================
   â˜… å³ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆå€¤å´ï¼‰ã‚’å³å¯„ã›ã«çµ±ä¸€
   ------------------------------------------------------------
   - 2ã‚«ãƒ©ãƒ ç³»: mini-grid / status-grid / delta-grid / once-grid
   - Totals(c/w) è¡Œ: 2ã€œ4åˆ—ã‚’å³å¯„ã›
   - lastday-grid / days-grid: ã€Œãƒ©ãƒ™ãƒ«ä»¥å¤–ã€ã‚’å³å¯„ã›
   ============================================================ */
#cscs_sync_monitor_a .mini-val,
#cscs_sync_monitor_a .status-value,
#cscs_sync_monitor_a .delta-val,
#cscs_sync_monitor_a .once-val{
  text-align: right;
}

/* Totals(c/w) ã®è¡Œã¯ 4ã‚«ãƒ©ãƒ ãªã®ã§ã€å€¤å´(2ã€œ4åˆ—)ã‚’å³å¯„ã› */
#cscs_sync_monitor_a .totals-row > :nth-child(2),
#cscs_sync_monitor_a .totals-row > :nth-child(3),
#cscs_sync_monitor_a .totals-row > :nth-child(4){
  text-align: right;
}

/* lastday-grid ã¯ 3ã‚«ãƒ©ãƒ ï¼ˆlabel / SYNC / localï¼‰
   â˜… 2åˆ—ç›®ï¼ˆçœŸã‚“ä¸­=SYNCåˆ—ï¼‰ã ã‘ã‚»ãƒ³ã‚¿ãƒ¼å¯„ã›
   â˜… 3åˆ—ç›®ï¼ˆlocalåˆ—ï¼‰ã¯å³å¯„ã› */
#cscs_sync_monitor_a .lastday-grid > :nth-child(3n+2){
  text-align: center;
}
#cscs_sync_monitor_a .lastday-grid > :nth-child(3n+3){
  text-align: right;
}

/* â˜… lastday è¦‹å‡ºã—ï¼ˆtype / SYNC / localï¼‰ã®å¯„ã›æ–¹ï¼šçœŸã‚“ä¸­ã ã‘ã‚»ãƒ³ã‚¿ãƒ¼ */
#cscs_sync_monitor_a .sync-lastday-headline > :nth-child(2){
  text-align: center;
}
#cscs_sync_monitor_a .sync-lastday-headline > :nth-child(3){
  text-align: right;
}

/* days-grid ã¯ 4ã‚«ãƒ©ãƒ ï¼ˆlabel / sync / local / isTodayï¼‰ */
#cscs_sync_monitor_a .days-grid > :nth-child(4n+2),
#cscs_sync_monitor_a .days-grid > :nth-child(4n+3),
#cscs_sync_monitor_a .days-grid > :nth-child(4n+4){
  text-align: right;
}

/* â˜… lastday ã¯æŠ˜ã‚ŠãŸãŸã¿ç„¡ã—ï¼šå¸¸æ™‚è¡¨ç¤ºã®1è¡Œãƒ˜ãƒƒãƒ€ãƒ¼ */
#cscs_sync_monitor_a .sync-lastday-headline{
  display: grid;

  /* â˜… lastday-grid ã¨åˆ—å¹…ã‚’å®Œå…¨ä¸€è‡´ã•ã›ã‚‹ï¼ˆlabel=80px / SYNC / localï¼‰ */
  grid-template-columns: 80px minmax(0,1fr) minmax(0,1fr);

  column-gap: 10px;
  align-items: baseline;
  white-space: nowrap;
  overflow: hidden;
  margin-bottom: 6px;
  font-weight: 700;
  font-size: 11px;
  opacity: 0.85;
}

/* â˜… type */
#cscs_sync_monitor_a .sync-lastday-headline .sync-lastday-summary-type{
  font-weight: 700;
  opacity: 0.90;
}

/* â˜… SYNC/local ã¯ã€Œç¸®ã‚€åˆ—ã€ã«å…¥ã‚Œã€å…¥ã‚Šåˆ‡ã‚‰ãªã„æ™‚ã¯ â€¦ ã§çœç•¥ã™ã‚‹ */
#cscs_sync_monitor_a .sync-lastday-headline .sync-lastday-summary-sync{
  font-variant-numeric: tabular-nums;
  opacity: 0.88;
  font-size: 10px;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
}
#cscs_sync_monitor_a .sync-lastday-headline .sync-lastday-summary-local{
  font-variant-numeric: tabular-nums;
  opacity: 0.88;
  font-size: 10px;
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
}
          `.trim();
          (document.head || document.documentElement).appendChild(st);
        }
      }catch(_){}

      const box = document.createElement("div");
      box.id = "cscs_sync_monitor_a";
      box.innerHTML = `
        <div class="sync-header">
          <span>SYNC(A): <span class="sync-qid"></span></span>
          <button type="button" class="sync-toggle-btn" data-sync-toggle="1">OPEN</button>
        </div>

		<div class="sync-card sync-init-card">
		  <div class="sync-wide-body">
		    <div class="sync-init-row">		
		      <span class="sync-mini">
		        user: <span class="sync-user-email">-</span>
		      </span>
		      <span class="sync-mini">
		        key: <span class="sync-key-status">-</span>
		      </span>
		      <span class="sync-mini">
		        state: <span class="sync-state-status">-</span>
		      </span>
		    </div>
		  </div>
		</div>

        <div class="sync-grid">
          <div class="sync-card sync-span-2">
            <div class="sync-body totals-row">
              <div class="sync-totals-label">Totals(c/w)</div>

              <div id="cscs_sync_totals" class="sync-totals" data-server-c="" data-server-i="">
                <span class="sync-server-text">SYNC - / -</span>
              </div>

              <div class="sync-local">local  0 / 0</div>
              <div class="sync-queue">+Î”    0 / 0</div>
            </div>
          </div>

          <div class="sync-card">
            <div class="sync-title">â­ï¸3é€£ç¶šæ­£è§£æ•° <span class="sync-title-en">Count</span></div>
            <div class="sync-body sync-streak3">
              SYNC <span class="sync-streak3-server">0</span> å› / local <span class="sync-streak3-val">0</span> å›
            </div>
          </div>

          <div class="sync-card">
            <div class="sync-title">ğŸ’£3é€£ç¶šä¸æ­£è§£ <span class="sync-title-en">Count</span></div>
            <div class="sync-body sync-wrong-streak3">
              SYNC <span class="sync-wrong-streak3-server">0</span> å› / local <span class="sync-wrong-streak3-val">0</span> å›
            </div>
          </div>

          <div class="sync-card">
            <div class="sync-title">3é€£ç¶šæ­£è§£ é€²æ— <span class="sync-title-en">Progress</span></div>
            <div class="sync-body sync-streaklen">
              SYNC (<span class="sync-streaklen-server-progress">0</span>/3) /
              local (<span class="sync-streaklen-local-progress">0</span>/3)
            </div>
          </div>

          <div class="sync-card">
            <div class="sync-title">3é€£ç¶šä¸æ­£è§£ é€²æ— <span class="sync-title-en">Progress</span></div>
            <div class="sync-body sync-wrong-streaklen">
              SYNC (<span class="sync-wrong-streaklen-server-progress">0</span>/3) /
              local (<span class="sync-wrong-streaklen-local-progress">0</span>/3)
            </div>
          </div>

          <div class="sync-card">
            <div class="sync-title">Streak3TodayUnique</div>
            <div class="sync-body sync-streak3today">
              <div class="mini-grid">
                <div class="mini-label">unique</div>
                <div class="mini-val">sync <span class="sync-streak3today-sync">0</span> / local <span class="sync-streak3today-local">0</span></div>
              </div>
            </div>
          </div>

          <div class="sync-card">
            <div class="sync-title">Streak3WrongTodayUq</div>
            <div class="sync-body sync-streak3wrongtoday">
              <div class="mini-grid">
                <div class="mini-label">unique</div>
                <div class="mini-val">sync <span class="sync-streak3wrongtoday-sync">0</span> / local <span class="sync-streak3wrongtoday-local">0</span></div>
              </div>
            </div>
          </div>

          <div class="sync-card">
            <div class="sync-title">é€£ç¶šæ­£è§£ (local)</div>
            <div class="sync-body">
              <div class="mini-grid">
                <div class="mini-label">streak_len</div>
                <div class="mini-val"><span class="sync-streakmax-len-local">-</span></div>

                <div class="mini-label">streak_max</div>
                <div class="mini-val"><span class="sync-streakmax-max-local">-</span></div>

                <div class="mini-label">max_day</div>
                <div class="mini-val"><span class="sync-streakmax-maxday-local">-</span></div>
              </div>
            </div>
          </div>

          <div class="sync-card">
            <div class="sync-title">é€£ç¶šä¸æ­£è§£ (local)</div>
            <div class="sync-body">
              <div class="mini-grid">
                <div class="mini-label">streak_len</div>
                <div class="mini-val"><span class="sync-wrong-streakmax-len-local">-</span></div>

                <div class="mini-label">streak_max</div>
                <div class="mini-val"><span class="sync-wrong-streakmax-max-local">-</span></div>

                <div class="mini-label">max_day</div>
                <div class="mini-val"><span class="sync-wrong-streakmax-maxday-local">-</span></div>
              </div>
            </div>
          </div>

          <div class="sync-card">
            <div class="sync-title">é€£ç¶šæ­£è§£ (SYNC)</div>
            <div class="sync-body">
              <div class="mini-grid">
                <div class="mini-label">streak_len</div>
                <div class="mini-val"><span class="sync-streakmax-len-sync">-</span></div>

                <div class="mini-label">streak_max</div>
                <div class="mini-val"><span class="sync-streakmax-max-sync">-</span></div>

                <div class="mini-label">max_day</div>
                <div class="mini-val"><span class="sync-streakmax-maxday-sync">-</span></div>
              </div>
            </div>
          </div>

          <div class="sync-card">
            <div class="sync-title">é€£ç¶šä¸æ­£è§£ (SYNC)</div>
            <div class="sync-body">
              <div class="mini-grid">
                <div class="mini-label">streak_len</div>
                <div class="mini-val"><span class="sync-wrong-streakmax-len-sync">-</span></div>

                <div class="mini-label">streak_max</div>
                <div class="mini-val"><span class="sync-wrong-streakmax-max-sync">-</span></div>

                <div class="mini-label">max_day</div>
                <div class="mini-val"><span class="sync-wrong-streakmax-maxday-sync">-</span></div>
              </div>
            </div>
          </div>

          <div class="sync-card sync-span-2 once-card once-card-sync">
            <div class="sync-title">
              <span class="once-title-text">OncePerDayToday / O.D.O.A Mode (SYNC)</span>
              <button type="button" class="once-fold-btn" data-once-fold="sync">â–¶show</button>
            </div>
            <div class="sync-body sync-onceperday sync">oncePerDayToday: -</div>
          </div>

          <div class="sync-card sync-span-2 once-card once-card-local">
            <div class="sync-title">
              <span class="once-title-text">OncePerDayToday / O.D.O.A Mode (local)</span>
              <button type="button" class="once-fold-btn" data-once-fold="local">â–¶show</button>
            </div>
            <div class="sync-body sync-onceperday local">oncePerDayToday: -</div>
          </div>

          <div class="sync-card sync-span-2">
            <div class="sync-lastday-headline">
              <span class="sync-lastday-summary-type">LastCorrect</span>
              <span class="sync-lastday-summary-sync">SYNC -</span>
              <span class="sync-lastday-summary-local">local -</span>
            </div>

            <div class="sync-body sync-lastday">
              <div class="lastday-grid">
                <div class="ld-label ld-row-lastseen">lastSeen</div>
                <div class="ld-row-lastseen"><span class="sync-last-seen-sync">-</span></div>
                <div class="ld-row-lastseen"><span class="sync-last-seen-local">-</span></div>

                <div class="ld-label ld-row-lastcorrect">lastCorrect</div>
                <div class="ld-row-lastcorrect"><span class="sync-last-correct-sync">-</span></div>
                <div class="ld-row-lastcorrect"><span class="sync-last-correct-local">-</span></div>

                <div class="ld-label ld-row-lastwrong">lastWrong</div>
                <div class="ld-row-lastwrong"><span class="sync-last-wrong-sync">-</span></div>
                <div class="ld-row-lastwrong"><span class="sync-last-wrong-local">-</span></div>
              </div>
            </div>
          </div>

          <div class="sync-card sync-span-2">
            <details class="sync-fold" data-fold="queue">
              <summary>Queue Î” detailï¼ˆé€ä¿¡å¾…ã¡ï¼‰</summary>
              <div class="sync-body">
                <div class="delta-grid">
                  <div class="delta-label">Totals(c/w)</div>
                  <div class="delta-val"><span class="sync-queue-cw">0 / 0</span></div>

                  <div class="delta-label">streak3Delta</div>
                  <div class="delta-val"><span class="sync-queue-s3">0</span></div>

                  <div class="delta-label">streakLenDelta</div>
                  <div class="delta-val"><span class="sync-queue-sl">ï¼ˆãªã—ï¼‰</span></div>

                  <div class="delta-label">streak3WrongDelta</div>
                  <div class="delta-val"><span class="sync-queue-s3w">0</span></div>

                  <div class="delta-label">streakWrongLenDelta</div>
                  <div class="delta-val"><span class="sync-queue-slw">ï¼ˆãªã—ï¼‰</span></div>

                  <div class="delta-label">lastSeenDayDelta</div>
                  <div class="delta-val"><span class="sync-queue-lastseen">ï¼ˆãªã—ï¼‰</span></div>

                  <div class="delta-label">lastCorrectDayDelta</div>
                  <div class="delta-val"><span class="sync-queue-lastcorrect">ï¼ˆãªã—ï¼‰</span></div>

                  <div class="delta-label">lastWrongDayDelta</div>
                  <div class="delta-val"><span class="sync-queue-lastwrong">ï¼ˆãªã—ï¼‰</span></div>
                </div>
              </div>
            </details>
          </div>

          <div class="sync-card sync-span-2">
            <div class="sync-body status-grid">
              <div class="status-label">Status</div>
              <div class="status-value">
                <span class="sync-status">pulled (-)</span>
                <button type="button" class="sync-nopull-btn" data-nopull-toggle="1">NO-PULL:OFF</button>
              </div>
            </div>
          </div>
        </div>

```
<<<PART_END>>>
ã€RECEIPT_INPUTï¼ˆã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã ã‘ã‚’çœŸã¨ã™ã‚‹ï¼‰ã€‘
EXPECTED_TOTAL: 5
RECEIVED_TOTAL: 4

CUMULATIVE_RECEIVED_PARTIDS:
- CSCSJS-1F73660D-P01-of-05
- CSCSJS-1F73660D-P02-of-05
- CSCSJS-1F73660D-P03-of-05
- CSCSJS-1F73660D-P04-of-05

ã€ChatGPTã¸ã®å¼·åˆ¶ãƒ«ãƒ¼ãƒ«ã€‘
ãƒ»å—é ˜ç¢ºèªã¯ã€ã“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…ã® CUMULATIVE_RECEIVED_PARTIDS ã¨ EXPECTED_PARTIDS ã®ã¿ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã€‚
ãƒ»ä¼šè©±å±¥æ­´ã‹ã‚‰ PartID ã‚’å†åé›†ã—ãªã„ã“ã¨ï¼ˆç¦æ­¢ï¼‰ã€‚
ãƒ»å—é ˜ç¢ºèªOKå‰ã«ã€ã‚³ãƒ¼ãƒ‰å†…å®¹ã®è§£é‡ˆãƒ»è¦ç´„ãƒ»æ¨æ¸¬ãƒ»ä¿®æ­£æ¡ˆæç¤ºã‚’ã—ãªã„ã“ã¨ï¼ˆç¦æ­¢ï¼‰ã€‚

RECEIPT_REQUIRED_RESPONSE_TEMPLATE:
ACK: <PartID> <PartSHA256_8> / WAITING_NEXT

ã€åˆ†å‰²ã‚³ãƒ¼ãƒ‰(4)ã®çµ‚äº†ã€‘â†’ æ¬¡ã¯ åˆ†å‰²ã‚³ãƒ¼ãƒ‰(5) ã‚’é€ã‚Šã¾ã™
ã€ChatGPTã¸ã®æŒ‡ç¤ºã€‘è§£é‡ˆãƒ»è¦ç´„ãƒ»æ¨æ¸¬ãƒ»ä¿®æ­£æ¡ˆæç¤ºã¯ç¦æ­¢ã€‚è¿”ç­”ã¯æ¬¡ã®ã¿ã€‚
ACK: <PartID> / WAITING_NEXT
